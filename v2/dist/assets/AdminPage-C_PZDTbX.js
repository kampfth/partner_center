import{c as w,r as i,u as De,j as e,a as Me,P as G,b as q,d as Ae,e as F,S as C,f as L,g as Fe,X as Q,W as Le}from"./index-DxbtoF3i.js";import{u as Re,a as Ve,c as ne,R as ze,I as Ue,P as Ge,T as ie,D as Oe,b as Be,d as He,e as qe,f as Ze,g as Ye}from"./dialog-CX1zxVgA.js";import{E as O,C as _,c as T,d as P,e as R,a as E,L as A,I as D,B as k,g as ce,h as le,i as Ke,j as We,T as Y,u as Xe,k as Je,l as Qe,s as es,m as ss,n as as,t as ts,R as rs,o as ns,p as is,q as ee,r as cs}from"./partnerApi-DKTAbEuZ.js";import{C as Z}from"./check-C4jE1-fW.js";const ls=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],os=w("circle-alert",ls);const ds=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],us=w("circle-check",ds);const ms=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]],xs=w("file-up",ms);const hs=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],ps=w("file",hs);const fs=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],gs=w("grip-vertical",fs);const vs=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],js=w("list-ordered",vs);const Ns=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],ys=w("package",Ns);const bs=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ws=w("rotate-ccw",bs);const Cs=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],oe=w("save",Cs);const ks=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],de=w("search",ks);const Ss=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ue=w("upload",Ss);const _s=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Ts=w("users",_s);var B="Tabs",[Ps]=Me(B,[ne]),me=ne(),[Es,K]=Ps(B),xe=i.forwardRef((s,a)=>{const{__scopeTabs:n,value:c,onValueChange:r,defaultValue:d,orientation:l="horizontal",dir:u,activationMode:o="automatic",...f}=s,m=Re(u),[h,N]=De({prop:c,onChange:r,defaultProp:d??"",caller:B});return e.jsx(Es,{scope:n,baseId:Ve(),value:h,onValueChange:N,orientation:l,dir:m,activationMode:o,children:e.jsx(G.div,{dir:m,"data-orientation":l,...f,ref:a})})});xe.displayName=B;var he="TabsList",pe=i.forwardRef((s,a)=>{const{__scopeTabs:n,loop:c=!0,...r}=s,d=K(he,n),l=me(n);return e.jsx(ze,{asChild:!0,...l,orientation:d.orientation,dir:d.dir,loop:c,children:e.jsx(G.div,{role:"tablist","aria-orientation":d.orientation,...r,ref:a})})});pe.displayName=he;var fe="TabsTrigger",ge=i.forwardRef((s,a)=>{const{__scopeTabs:n,value:c,disabled:r=!1,...d}=s,l=K(fe,n),u=me(n),o=Ne(l.baseId,c),f=ye(l.baseId,c),m=c===l.value;return e.jsx(Ue,{asChild:!0,...u,focusable:!r,active:m,children:e.jsx(G.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":f,"data-state":m?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:o,...d,ref:a,onMouseDown:q(s.onMouseDown,h=>{!r&&h.button===0&&h.ctrlKey===!1?l.onValueChange(c):h.preventDefault()}),onKeyDown:q(s.onKeyDown,h=>{[" ","Enter"].includes(h.key)&&l.onValueChange(c)}),onFocus:q(s.onFocus,()=>{const h=l.activationMode!=="manual";!m&&!r&&h&&l.onValueChange(c)})})})});ge.displayName=fe;var ve="TabsContent",je=i.forwardRef((s,a)=>{const{__scopeTabs:n,value:c,forceMount:r,children:d,...l}=s,u=K(ve,n),o=Ne(u.baseId,c),f=ye(u.baseId,c),m=c===u.value,h=i.useRef(m);return i.useEffect(()=>{const N=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(N)},[]),e.jsx(Ae,{present:r||m,children:({present:N})=>e.jsx(G.div,{"data-state":m?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":o,hidden:!N,id:f,tabIndex:0,...l,ref:a,style:{...s.style,animationDuration:h.current?"0s":void 0},children:N&&d})})});je.displayName=ve;function Ne(s,a){return`${s}-trigger-${a}`}function ye(s,a){return`${s}-content-${a}`}var $s=xe,be=pe,we=ge,Ce=je;const Is=$s,ke=i.forwardRef(({className:s,...a},n)=>e.jsx(be,{ref:n,className:F("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a}));ke.displayName=be.displayName;const $=i.forwardRef(({className:s,...a},n)=>e.jsx(we,{ref:n,className:F("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...a}));$.displayName=we.displayName;const I=i.forwardRef(({className:s,...a},n)=>e.jsx(Ce,{ref:n,className:F("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a}));I.displayName=Ce.displayName;const W=i.forwardRef(({className:s,checked:a,onCheckedChange:n,...c},r)=>e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",ref:r,checked:a,onChange:d=>n?.(d.target.checked),className:"sr-only peer",...c}),e.jsx("div",{className:F("h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 peer-checked:bg-primary peer-checked:text-primary-foreground flex items-center justify-center",s),children:a&&e.jsx(Z,{className:"h-3 w-3"})})]}));W.displayName="Checkbox";function H({message:s="Loading...",variant:a="page",count:n=4}){return a==="inline"?e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),e.jsx("span",{className:"text-sm",children:s})]}):a==="cards"?e.jsx("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4 animate-fade-in",children:Array.from({length:n}).map((c,r)=>e.jsxs("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[e.jsx(C,{className:"h-4 w-1/2"}),e.jsx(C,{className:"h-8 w-3/4"})]},r))}):a==="list"?e.jsx("div",{className:"space-y-3 animate-fade-in",children:Array.from({length:n}).map((c,r)=>e.jsxs("div",{className:"rounded-lg border bg-card p-4 flex items-center gap-4",children:[e.jsx(C,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(C,{className:"h-4 w-1/3"}),e.jsx(C,{className:"h-3 w-1/2"})]}),e.jsx(C,{className:"h-8 w-16"})]},r))}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"h-8 w-48"}),e.jsx(C,{className:"h-4 w-64"})]}),e.jsx("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:Array.from({length:4}).map((c,r)=>e.jsxs("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[e.jsx(C,{className:"h-4 w-1/2"}),e.jsx(C,{className:"h-8 w-3/4"})]},r))}),e.jsx("div",{className:"rounded-lg border bg-card p-4",children:e.jsx(C,{className:"h-64 w-full"})})]})}function Ds(){const[s,a]=i.useState([]),[n,c]=i.useState([]),[r,d]=i.useState(!0),[l,u]=i.useState(null),[o,f]=i.useState(""),[m,h]=i.useState(new Set),[N,j]=i.useState(!1),[v,y]=i.useState(""),{toast:t}=L(),g=async()=>{d(!0),u(null);try{const[p,z]=await Promise.all([ce(),le()]);a(p),c(z)}catch(p){u(p instanceof Error?p.message:"Failed to load data")}finally{d(!1)}};i.useEffect(()=>{g()},[]);const x=p=>{h(z=>{const M=new Set(z);return M.has(p)?M.delete(p):M.add(p),M})},b=async()=>{if(!o.trim()){t({variant:"destructive",title:"Error",description:"Please enter a group name"});return}if(m.size<2){t({variant:"destructive",title:"Error",description:"Select at least 2 products to create a group"});return}j(!0);try{await Ke(o.trim(),Array.from(m)),t({title:"Success",description:`Group "${o}" created with ${m.size} products`}),f(""),h(new Set),await g()}catch(p){t({variant:"destructive",title:"Error",description:p instanceof Error?p.message:"Failed to create group"})}finally{j(!1)}},S=s.filter(p=>p.group_id===null).filter(p=>p.product_name.toLowerCase().includes(v.toLowerCase())||p.label&&p.label.toLowerCase().includes(v.toLowerCase()));return r?e.jsx(H,{message:"Loading products and groups..."}):l?e.jsx(O,{message:l,onRetry:g}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(_,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"Create New Group"}),e.jsx(R,{children:"Select at least 2 ungrouped products to create a group"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"groupName",children:"Group Name"}),e.jsx(D,{id:"groupName",value:o,onChange:p=>f(p.target.value),placeholder:"Enter group name..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{children:["Select Products (",m.size," selected)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Search products...",value:v,onChange:p=>y(p.target.value),className:"pl-9 mb-2"})]}),e.jsx("div",{className:"max-h-[300px] overflow-auto rounded-md border p-4 space-y-2",children:S.length>0?S.map(p=>e.jsxs("div",{className:"flex items-center space-x-3 rounded-md p-2 hover:bg-accent/50",children:[e.jsx(W,{id:p.product_id,checked:m.has(p.product_id),onCheckedChange:()=>x(p.product_id)}),e.jsxs("label",{htmlFor:p.product_id,className:"flex-1 cursor-pointer text-sm",children:[e.jsx("span",{className:"font-medium",children:p.label||p.product_name}),e.jsxs("span",{className:"ml-2 text-muted-foreground",children:["(",p.lever,")"]})]})]},p.product_id)):e.jsx("p",{className:"py-4 text-center text-muted-foreground",children:v?"No products found matching search":"All products are already grouped"})})]}),e.jsxs(k,{onClick:b,disabled:N||m.size<2||!o.trim(),className:"w-full",children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Create Group"]})]})]}),e.jsxs(_,{children:[e.jsx(T,{children:e.jsxs(P,{children:["Existing Groups (",n.length,")"]})}),e.jsx(E,{children:n.length>0?e.jsx("div",{className:"space-y-2",children:n.map(p=>{const z=s.filter(M=>M.group_id===p.id);return e.jsx("div",{className:"flex items-center justify-between rounded-md border p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:p.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[z.length," products"]})]})},p.id)})}):e.jsx("p",{className:"py-4 text-center text-muted-foreground",children:"No groups created yet"})})]})]})}function Ms(s,a=[]){let n=[];function c(d,l){const u=i.createContext(l);u.displayName=d+"Context";const o=n.length;n=[...n,l];const f=h=>{const{scope:N,children:j,...v}=h,y=N?.[s]?.[o]||u,t=i.useMemo(()=>v,Object.values(v));return e.jsx(y.Provider,{value:t,children:j})};f.displayName=d+"Provider";function m(h,N){const j=N?.[s]?.[o]||u,v=i.useContext(j);if(v)return v;if(l!==void 0)return l;throw new Error(`\`${h}\` must be used within \`${d}\``)}return[f,m]}const r=()=>{const d=n.map(l=>i.createContext(l));return function(u){const o=u?.[s]||d;return i.useMemo(()=>({[`__scope${s}`]:{...u,[s]:o}}),[u,o])}};return r.scopeName=s,[c,As(r,...a)]}function As(...s){const a=s[0];if(s.length===1)return a;const n=()=>{const c=s.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(d){const l=c.reduce((u,{useScope:o,scopeName:f})=>{const h=o(d)[`__scope${f}`];return{...u,...h}},{});return i.useMemo(()=>({[`__scope${a.scopeName}`]:l}),[l])}};return n.scopeName=a.scopeName,n}var Fs=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Se=Fs.reduce((s,a)=>{const n=We(`Primitive.${a}`),c=i.forwardRef((r,d)=>{const{asChild:l,...u}=r,o=l?n:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(o,{...u,ref:d})});return c.displayName=`Primitive.${a}`,{...s,[a]:c}},{}),X="Progress",J=100,[Ls]=Ms(X),[Rs,Vs]=Ls(X),_e=i.forwardRef((s,a)=>{const{__scopeProgress:n,value:c=null,max:r,getValueLabel:d=zs,...l}=s;(r||r===0)&&!se(r)&&console.error(Us(`${r}`,"Progress"));const u=se(r)?r:J;c!==null&&!ae(c,u)&&console.error(Gs(`${c}`,"Progress"));const o=ae(c,u)?c:null,f=U(o)?d(o,u):void 0;return e.jsx(Rs,{scope:n,value:o,max:u,children:e.jsx(Se.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":U(o)?o:void 0,"aria-valuetext":f,role:"progressbar","data-state":Ee(o,u),"data-value":o??void 0,"data-max":u,...l,ref:a})})});_e.displayName=X;var Te="ProgressIndicator",Pe=i.forwardRef((s,a)=>{const{__scopeProgress:n,...c}=s,r=Vs(Te,n);return e.jsx(Se.div,{"data-state":Ee(r.value,r.max),"data-value":r.value??void 0,"data-max":r.max,...c,ref:a})});Pe.displayName=Te;function zs(s,a){return`${Math.round(s/a*100)}%`}function Ee(s,a){return s==null?"indeterminate":s===a?"complete":"loading"}function U(s){return typeof s=="number"}function se(s){return U(s)&&!isNaN(s)&&s>0}function ae(s,a){return U(s)&&!isNaN(s)&&s<=a&&s>=0}function Us(s,a){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${a}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${J}\`.`}function Gs(s,a){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${a}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${J} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var $e=_e,Os=Pe;const Ie=i.forwardRef(({className:s,value:a,...n},c)=>e.jsx($e,{ref:c,className:F("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...n,children:e.jsx(Os,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));Ie.displayName=$e.displayName;function Bs(){const[s,a]=i.useState(null),[n,c]=i.useState(!1),[r,d]=i.useState(0),[l,u]=i.useState(null),o=i.useRef(null),{toast:f}=L(),m=j=>{const v=j.target.files?.[0];if(v){const y=[".csv",".zip"],t=v.name.toLowerCase().slice(v.name.lastIndexOf("."));if(!y.includes(t)){f({variant:"destructive",title:"Invalid file type",description:"Please upload a CSV or ZIP file"});return}a(v),u(null),d(0)}},h=async()=>{if(s){c(!0),u(null),d(0);try{const j=await Xe(s,v=>{d(v)});u(j),f({title:"Upload Complete",description:`Rows ${j.rows_read}, inserted ${j.transactions_inserted}, discovered ${j.products_discovered}`})}catch(j){f({variant:"destructive",title:"Upload Failed",description:j instanceof Error?j.message:"Failed to upload file"})}finally{c(!1)}}},N=()=>{a(null),u(null),d(0),o.current&&(o.current.value="")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(_,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"Upload Transactions"}),e.jsx(R,{children:"Upload CSV or ZIP files containing transaction data"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("input",{type:"file",ref:o,onChange:m,accept:".csv,.zip",className:"hidden"}),s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ps,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(s.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:N,disabled:n,children:"Remove"}),e.jsxs(k,{size:"sm",onClick:h,disabled:n,children:[e.jsx(xs,{className:"mr-2 h-4 w-4"}),n?"Uploading...":"Upload"]})]})]}),n&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Uploading..."}),e.jsxs("span",{className:"font-medium tabular-nums",children:[r,"%"]})]}),e.jsx(Ie,{value:r,className:"h-2"}),r===100&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processing file on server..."})]})]}):e.jsxs("div",{onClick:()=>o.current?.click(),className:"flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-border p-12 transition-colors hover:border-primary/50 hover:bg-accent/50",children:[e.jsx(ue,{className:"h-10 w-10 text-muted-foreground"}),e.jsx("p",{className:"mt-4 font-medium",children:"Click to upload"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"CSV or ZIP files (max 50MB)"})]})]})]}),l&&e.jsxs(_,{children:[e.jsx(T,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[l.transactions_skipped>0?e.jsx(Y,{className:"h-5 w-5 text-warning"}):e.jsx(us,{className:"h-5 w-5 text-primary"}),"Upload Result"]})}),e.jsx(E,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processed"}),e.jsx("p",{className:"text-2xl font-bold",children:l.rows_read})]}),e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Products Discovered"}),e.jsx("p",{className:"text-2xl font-bold",children:l.products_discovered})]}),e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inserted"}),e.jsx("p",{className:"text-2xl font-bold",children:l.transactions_inserted})]}),e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Untracked"}),e.jsx("p",{className:"text-2xl font-bold",children:l.transactions_untracked})]})]})})]})]})}function te(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s)}function Hs(){const[s,a]=i.useState([]),[n,c]=i.useState(!0),[r,d]=i.useState(!1),[l,u]=i.useState(null),{toast:o}=L(),[f,m]=i.useState(new Date().getFullYear().toString()),[h,N]=i.useState(""),[j,v]=i.useState(""),y=async()=>{c(!0),u(null);try{const x=await Je();a(Array.isArray(x)?x:[])}catch(x){u(x instanceof Error?x.message:"Failed to load initial cash data")}finally{c(!1)}};i.useEffect(()=>{y()},[]);const t=async()=>{const x=parseInt(f,10),b=parseFloat(h);if(isNaN(x)||x<2e3||x>2100){o({variant:"destructive",title:"Invalid year"});return}if(isNaN(b)){o({variant:"destructive",title:"Invalid amount"});return}d(!0);try{await es(x,b,j||void 0),o({title:"Saved",description:`Initial cash for ${x} set to ${te(b)}`}),N(""),v(""),y()}catch(V){o({variant:"destructive",title:"Error",description:V instanceof Error?V.message:"Failed to save"})}finally{d(!1)}},g=async x=>{if(confirm(`Delete initial cash for ${x}?`))try{await Qe(x),o({title:"Deleted",description:`Initial cash for ${x} removed`}),y()}catch(b){o({variant:"destructive",title:"Error",description:b instanceof Error?b.message:"Failed to delete"})}};return n?e.jsx(H,{message:"Loading balance settings..."}):l?e.jsx(O,{message:l,onRetry:y}):e.jsx("div",{className:"space-y-6",children:e.jsxs(_,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"Initial Cash (Caixa Inicial)"}),e.jsx(R,{children:"Define the starting cash balance for each year. This is added to the first month's revenue in Balance calculations."})]}),e.jsxs(E,{className:"space-y-6",children:[s.length>0&&e.jsx("div",{className:"rounded-lg border divide-y",children:s.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:x.year}),e.jsx("span",{className:"ml-4 text-lg font-mono",children:te(x.amount)}),x.note&&e.jsxs("span",{className:"ml-4 text-sm text-muted-foreground",children:["(",x.note,")"]})]}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>g(x.year),children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})]},x.year))}),s.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No initial cash defined yet. Add one below."}),e.jsxs("div",{className:"pt-4 border-t space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Add or Update Initial Cash"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"ic-year",children:"Year"}),e.jsx(D,{id:"ic-year",type:"number",min:"2000",max:"2100",value:f,onChange:x=>m(x.target.value)})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"ic-amount",children:"Amount ($)"}),e.jsx(D,{id:"ic-amount",type:"number",step:"0.01",placeholder:"0.00",value:h,onChange:x=>N(x.target.value)})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx(A,{htmlFor:"ic-note",children:"Note (optional)"}),e.jsx(D,{id:"ic-note",placeholder:"e.g. Carried from 2025",value:j,onChange:x=>v(x.target.value)})]}),e.jsx("div",{children:e.jsxs(k,{onClick:t,disabled:r,className:"w-full",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),r?"Saving...":"Save"]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If a year already exists, it will be updated with the new value."})]})]})]})})}const qs=Fe("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function re({className:s,variant:a,...n}){return e.jsx("div",{className:F(qs({variant:a}),s),...n})}function Zs(){const[s,a]=i.useState([]),[n,c]=i.useState(!0),[r,d]=i.useState(null),[l,u]=i.useState(""),[o,f]=i.useState(new Set),{toast:m}=L(),h=async()=>{c(!0),d(null);try{const t=await ss();a(t)}catch(t){d(t instanceof Error?t.message:"Failed to load products")}finally{c(!1)}};i.useEffect(()=>{h()},[]);const N=async t=>{f(g=>new Set(g).add(t.product_id));try{t.is_tracked?(await as(t.product_id),m({title:"Success",description:`"${t.product_name}" is no longer tracked`})):(await ts(t.product_id),m({title:"Success",description:`"${t.product_name}" is now being tracked`})),await h()}catch(g){m({variant:"destructive",title:"Error",description:g instanceof Error?g.message:"Failed to update tracking"})}finally{f(g=>{const x=new Set(g);return x.delete(t.product_id),x})}},j=s.filter(t=>t.product_name.toLowerCase().includes(l.toLowerCase())||t.lever&&t.lever.toLowerCase().includes(l.toLowerCase())||t.product_id.toLowerCase().includes(l.toLowerCase())),v=s.filter(t=>t.is_tracked).length,y=s.length-v;return n?e.jsx(H,{message:"Loading products..."}):r?e.jsx(O,{message:r,onRetry:h}):e.jsx("div",{className:"space-y-6",children:e.jsxs(_,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"Product Tracking"}),e.jsx(R,{children:"Manage which products are tracked in reports and analytics. Products are automatically discovered when you upload CSV files."})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"font-medium",children:[v," Tracked"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:[y," Not Tracked"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-medium",children:[s.length," Total"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Search by product name, lever, or ID...",value:l,onChange:t=>u(t.target.value),className:"pl-9"})]}),e.jsx("div",{className:"max-h-[500px] overflow-auto rounded-md border",children:j.length>0?e.jsx("div",{className:"divide-y",children:j.map(t=>{const g=o.has(t.product_id);return e.jsxs("div",{className:"flex items-center gap-3 p-3 hover:bg-accent/50 transition-colors",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(W,{id:`track-${t.id}`,checked:t.is_tracked,disabled:g,onCheckedChange:()=>N(t)})}),e.jsxs("label",{htmlFor:`track-${t.id}`,className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:t.product_name}),t.is_tracked?e.jsx(re,{variant:"default",className:"text-xs bg-green-600",children:"Tracked"}):e.jsx(re,{variant:"secondary",className:"text-xs",children:"Not Tracked"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-0.5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Lever:"})," ",t.lever||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",t.product_id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Last seen:"})," ",new Date(t.last_seen_at).toLocaleDateString()]})]})]}),e.jsx("div",{children:e.jsx(k,{size:"sm",variant:t.is_tracked?"outline":"default",disabled:g,onClick:()=>N(t),children:g?"Processing...":t.is_tracked?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Stop Tracking"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Track"]})})})]},t.id)})}):e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:l?"No products found matching search":"No products discovered yet. Upload a CSV to discover products."})})})]})]})})}function Ys(){const[s,a]=i.useState([]),[n,c]=i.useState(!0),[r,d]=i.useState(!1),[l,u]=i.useState(null),[o,f]=i.useState(null),{toast:m}=L(),h=async()=>{c(!0),u(null);try{const[t,g,x]=await Promise.all([ns(),ce(),le()]);if(t.value&&t.value.length>0)a(t.value);else{const b=x.map(S=>S.name),V=g.filter(S=>!S.group_id).map(S=>S.label||S.product_name);a([...b,...V])}}catch(t){u(t instanceof Error?t.message:"Failed to load sort order")}finally{c(!1)}};i.useEffect(()=>{h()},[]);const N=t=>{f(t)},j=(t,g)=>{if(t.preventDefault(),o===null||o===g)return;const x=[...s],[b]=x.splice(o,1);x.splice(g,0,b),a(x),f(g)},v=()=>{f(null)},y=async()=>{d(!0);try{await is(s),m({title:"Success",description:"Sort order saved"})}catch(t){m({variant:"destructive",title:"Error",description:t instanceof Error?t.message:"Failed to save sort order"})}finally{d(!1)}};return n?e.jsx(H,{message:"Loading sort order..."}):l?e.jsx(O,{message:l,onRetry:h}):e.jsxs(_,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"Sort Order"}),e.jsx(R,{children:"Drag items to reorder how they appear in reports"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border divide-y",children:s.map((t,g)=>e.jsxs("div",{draggable:!0,onDragStart:()=>N(g),onDragOver:x=>j(x,g),onDragEnd:v,className:`flex items-center gap-3 p-3 cursor-move transition-colors ${o===g?"bg-accent":"hover:bg-accent/50"}`,children:[e.jsx(gs,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm text-muted-foreground w-6",children:g+1}),e.jsx("span",{className:"flex-1 font-medium",children:t})]},`${t}-${g}`))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:y,disabled:r,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),r?"Saving...":"Save Order"]}),e.jsxs(k,{variant:"outline",onClick:h,children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]})]})}function Ks({open:s,onOpenChange:a,title:n,description:c,children:r,footer:d}){return e.jsx(Oe,{open:s,onOpenChange:a,children:e.jsxs(Be,{className:"sm:max-w-[500px]",children:[e.jsxs(He,{children:[e.jsx(qe,{children:n}),c&&e.jsx(Ze,{children:c})]}),e.jsx("div",{className:"py-4",children:r}),d&&e.jsx(Ye,{children:d})]})})}function Ws(){const[s,a]=i.useState(null),[n,c]=i.useState(""),[r,d]=i.useState(!1),{toast:l}=L(),u=[{id:"clear_transactions",title:"Clear Transactions",description:"Delete all transaction records. This cannot be undone.",confirmText:"DELETE",action:async()=>{await ee("transactions")}},{id:"clear_audit",title:"Clear Audit Logs",description:"Delete all audit log entries. This cannot be undone.",confirmText:"DELETE",action:async()=>{await ee("audit_logs")}},{id:"reset_all",title:"Reset All Data",description:"Delete ALL data including products, groups, and transactions. This is a complete factory reset.",confirmText:"RESET",action:async()=>{await cs()}}],o=async()=>{if(s){if(n!==s.confirmText){l({variant:"destructive",title:"Confirmation failed",description:`Please type "${s.confirmText}" to confirm`});return}d(!0);try{await s.action(),l({title:"Success",description:`${s.title} completed`}),f()}catch(m){l({variant:"destructive",title:"Error",description:m instanceof Error?m.message:"Action failed"})}finally{d(!1)}}},f=()=>{a(null),c("")};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{className:"border-destructive/30",children:[e.jsxs(T,{children:[e.jsxs(P,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(Y,{className:"h-5 w-5"}),"Danger Zone"]}),e.jsx(R,{children:"Irreversible actions that affect your data. Use with extreme caution."})]}),e.jsx(E,{className:"space-y-4",children:u.map(m=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-destructive/20 bg-destructive/5 p-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.description})]}),e.jsxs(k,{variant:"destructive",size:"sm",onClick:()=>a(m),children:[m.id==="reset_all"?e.jsx(ws,{className:"mr-2 h-4 w-4"}):e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Execute"]})]},m.id))})]}),e.jsx(Ks,{open:!!s,onOpenChange:m=>!m&&f(),title:`Confirm: ${s?.title}`,description:"This action cannot be undone. Please read carefully.",footer:e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"outline",onClick:f,disabled:r,children:"Cancel"}),e.jsx(k,{variant:"destructive",onClick:o,disabled:r||n!==s?.confirmText,children:r?"Executing...":"Confirm"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg bg-destructive/10 p-4",children:e.jsxs("p",{className:"text-sm text-destructive",children:[e.jsx("strong",{children:"Warning:"})," ",s?.description]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{htmlFor:"confirm",children:["Type ",e.jsx("strong",{children:s?.confirmText})," to confirm"]}),e.jsx(D,{id:"confirm",value:n,onChange:m=>c(m.target.value),placeholder:s?.confirmText,className:"font-mono"})]})]})})]})}function sa(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage groups, upload data, and configure settings"})]}),e.jsxs(Is,{defaultValue:"groups",className:"w-full",children:[e.jsxs(ke,{className:"grid w-full max-w-[900px] grid-cols-6",children:[e.jsxs($,{value:"groups",className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Groups"})]}),e.jsxs($,{value:"products",className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Products"})]}),e.jsxs($,{value:"upload",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Upload"})]}),e.jsxs($,{value:"balance",className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Balance"})]}),e.jsxs($,{value:"sort",className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sort"})]}),e.jsxs($,{value:"danger",className:"flex items-center gap-2 text-destructive data-[state=active]:text-destructive",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Danger"})]})]}),e.jsx(I,{value:"groups",className:"mt-6",children:e.jsx(Ds,{})}),e.jsx(I,{value:"products",className:"mt-6",children:e.jsx(Zs,{})}),e.jsx(I,{value:"upload",className:"mt-6",children:e.jsx(Bs,{})}),e.jsx(I,{value:"balance",className:"mt-6",children:e.jsx(Hs,{})}),e.jsx(I,{value:"sort",className:"mt-6",children:e.jsx(Ys,{})}),e.jsx(I,{value:"danger",className:"mt-6",children:e.jsx(Ws,{})})]})]})}export{sa as default};
