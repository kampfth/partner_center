const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BarChartComponent-PUGNqWxi.js","assets/index-CK72GwF3.js","assets/index-C6NMG5YU.css","assets/CategoricalChart-CeyuZl9y.js","assets/CartesianChart-xbA3xvRW.js","assets/Legend-ChUwdl6j.js","assets/ActiveShapeUtils-DH7mdcL4.js","assets/Area-IGo5Nhw2.js","assets/ErrorBarContext-DRoT-tyS.js","assets/ProductPieChart-CaXCX3au.js","assets/tooltipContext-CvHe6hWn.js","assets/WeekdayBarChart-arCjTwjm.js","assets/BarChart-Duz1YVqV.js","assets/HotTimeChart-IhDxGTFi.js","assets/MsfsComparisonCard-Cl82MF0f.js"])))=>i.map(i=>d[i]);
import{c as Q,r as t,j as e,e as j,g as xe,_ as D}from"./index-CK72GwF3.js";import{f as ue,q as he,x as fe,y as je,z as pe,E as ye,L as q,I as J,B as K,C as g,e as N,g as b,a as _,S as p,b as h,c as ge}from"./partnerApi-AZjBTfu_.js";import{C as Ne}from"./check-Cdai882B.js";import{f,s as F}from"./format-DiB1zjxr.js";const be=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],_e=Q("copy",be);const ve=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],we=Q("message-circle",ve),X=t.forwardRef(({className:o,...d},c)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:c,className:j("w-full caption-bottom text-sm",o),...d})}));X.displayName="Table";const Y=t.forwardRef(({className:o,...d},c)=>e.jsx("thead",{ref:c,className:j("[&_tr]:border-b",o),...d}));Y.displayName="TableHeader";const Z=t.forwardRef(({className:o,...d},c)=>e.jsx("tbody",{ref:c,className:j("[&_tr:last-child]:border-0",o),...d}));Z.displayName="TableBody";const Se=t.forwardRef(({className:o,...d},c)=>e.jsx("tfoot",{ref:c,className:j("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",o),...d}));Se.displayName="TableFooter";const A=t.forwardRef(({className:o,...d},c)=>e.jsx("tr",{ref:c,className:j("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",o),...d}));A.displayName="TableRow";const v=t.forwardRef(({className:o,...d},c)=>e.jsx("th",{ref:c,className:j("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",o),...d}));v.displayName="TableHead";const w=t.forwardRef(({className:o,...d},c)=>e.jsx("td",{ref:c,className:j("p-4 align-middle [&:has([role=checkbox])]:pr-0",o),...d}));w.displayName="TableCell";const De=t.forwardRef(({className:o,...d},c)=>e.jsx("caption",{ref:c,className:j("mt-4 text-sm text-muted-foreground",o),...d}));De.displayName="TableCaption";const Ce=t.lazy(()=>D(()=>import("./BarChartComponent-PUGNqWxi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Te=t.lazy(()=>D(()=>import("./ProductPieChart-CaXCX3au.js"),__vite__mapDeps([9,1,2,3,10,6,5]))),Me=t.lazy(()=>D(()=>import("./WeekdayBarChart-arCjTwjm.js"),__vite__mapDeps([11,1,2,3,12,10,6,8,4]))),ke=t.lazy(()=>D(()=>import("./HotTimeChart-IhDxGTFi.js"),__vite__mapDeps([13,1,2,3,12,10,6,8,4]))),Re=t.lazy(()=>D(()=>import("./MsfsComparisonCard-Cl82MF0f.js"),__vite__mapDeps([14,1,2])));function k(o){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(o)}function Be(){const[o,d]=t.useState(null),[c,ee]=t.useState(null),[m,C]=t.useState(""),[x,T]=t.useState(""),[y,te]=t.useState(null),[M,ae]=t.useState([]),[S,B]=t.useState(!0),[u,se]=t.useState(!0),[I,O]=t.useState(null),[z,L]=t.useState(!1),[V,re]=t.useState([]),[$,le]=t.useState([]),[H,ne]=t.useState([]),[R,U]=t.useState(!1),{toast:oe}=xe();t.useEffect(()=>{async function a(){try{const l=await ge();if(d(l.min_date),ee(l.max_date),l.max_date){const n=new Date(l.max_date),s=f(F(n),"yyyy-MM-dd");C(s),T(l.max_date)}else{const n=new Date;C(f(F(n),"yyyy-MM-dd")),T(f(n,"yyyy-MM-dd"))}}catch(l){console.error("Failed to load date range:",l);const n=new Date;C(f(F(n),"yyyy-MM-dd")),T(f(n,"yyyy-MM-dd"))}finally{se(!1)}}a()},[]);const E=t.useCallback(async()=>{if(!(!m||!x)){B(!0),U(!0),O(null);try{const[a,l,n,s,r]=await Promise.all([ue(m,x),he(),fe(m,x),je(m,x),pe(m,x)]);te(a),ae(l.value||[]),re(n),le(s),ne(r)}catch(a){O(a instanceof Error?a.message:"Failed to load report")}finally{B(!1),U(!1)}}},[m,x]);t.useEffect(()=>{!u&&m&&x&&E()},[E,u,m,x]);const i=t.useMemo(()=>{if(!y?.summary)return[];const a=[...y.summary];return M.length===0?a.sort((l,n)=>n.total_amount-l.total_amount):a.sort((l,n)=>{const s=M.indexOf(l.display_name),r=M.indexOf(n.display_name);return s===-1&&r===-1?n.total_amount-l.total_amount:s===-1?1:r===-1?-1:s-r})},[y?.summary,M]),W=t.useMemo(()=>y?.daily?y.daily.map(a=>({date:f(new Date(a.date),"MMM dd"),sales:a.total_amount,units:a.total_units})):[],[y]),G=t.useMemo(()=>{if(!i.length)return[];const a=i.reduce((r,P)=>r+P.total_amount,0);if(a===0)return[];const l=i.map(r=>({name:r.display_name,value:r.total_amount,percentage:r.total_amount/a*100})),n=l.filter(r=>r.percentage>=5),s=l.filter(r=>r.percentage<5);if(s.length>0){const r=s.reduce((ie,me)=>ie+me.value,0),P=r/a*100;n.push({name:"Others",value:r,percentage:P})}return n},[i]),ce=()=>{if(!i.length)return;const a=["Product","Total Amount","Units Sold","Avg Amount"],l=i.map(s=>{const r=s.units_sold>0?s.total_amount/s.units_sold:0;return[s.display_name,s.total_amount.toFixed(2),s.units_sold.toString(),r.toFixed(2)]}),n=[a.join("	"),...l.map(s=>s.join("	"))].join(`
`);navigator.clipboard.writeText(n).then(()=>{L(!0),oe({title:"Copied!",description:"Paste into Google Sheets"}),setTimeout(()=>L(!1),2e3)})},de=()=>{if(!i.length)return;const a=i.reduce((s,r)=>s+r.total_amount,0),l=["ðŸ“Š *Sales Report*",`ðŸ“… ${f(new Date(m),"MMM d")} - ${f(new Date(x),"MMM d, yyyy")}`,"",`ðŸ’° *Total: ${k(a)}*`,"",...i.slice(0,10).map((s,r)=>`${r+1}. ${s.display_name}: ${k(s.total_amount)}`)],n=encodeURIComponent(l.join(`
`));window.open(`https://wa.me/?text=${n}`,"_blank")};return I?e.jsx(ye,{message:I,onRetry:E}):e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Reports"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sales report and export"})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"start",className:"text-xs text-muted-foreground",children:"From"}),e.jsx(J,{id:"start",type:"date",value:m,min:o||void 0,max:c||void 0,onChange:a=>C(a.target.value),className:"h-9 w-[140px]"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"end",className:"text-xs text-muted-foreground",children:"To"}),e.jsx(J,{id:"end",type:"date",value:x,min:o||void 0,max:c||void 0,onChange:a=>T(a.target.value),className:"h-9 w-[140px]"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(K,{variant:"secondary",size:"sm",onClick:ce,disabled:S||u||!i.length,children:[z?e.jsx(Ne,{className:"h-4 w-4 mr-2"}):e.jsx(_e,{className:"h-4 w-4 mr-2"}),z?"Copied!":"Copy for Sheets"]}),e.jsxs(K,{variant:"secondary",size:"sm",onClick:de,disabled:S||u||!i.length,children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Send via WhatsApp"]})]})]})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"MSFS 2020 vs 2024"})}),e.jsx(_,{children:R||u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{className:"h-24"}),e.jsx(p,{className:"h-24"})]}),e.jsx(p,{className:"h-3 w-full"})]}):H.length>0?e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-32",children:e.jsx(h,{})}),children:e.jsx(Re,{data:H})}):e.jsx("p",{className:"py-8 text-center text-sm text-muted-foreground",children:"No data available"})})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"Daily Sales"})}),e.jsx(_,{className:"pt-0",children:S||u?e.jsx(h,{}):W.length>0?e.jsx(t.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Ce,{data:W})}):e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:"No data available"})})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"Product Distribution"})}),e.jsx(_,{className:"pt-0",children:S||u?e.jsx("div",{className:"h-[280px] flex items-center justify-center",children:e.jsx(p,{className:"h-[180px] w-[180px] rounded-full"})}):G.length>0?e.jsx(t.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Te,{data:G})}):e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:"No data available"})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"Sales by Day of Week"})}),e.jsx(_,{className:"pt-0",children:R||u?e.jsx(h,{}):V.length>0?e.jsx(t.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Me,{data:V})}):e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:"No data available"})})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"Hot Time (UTC)"})}),e.jsx(_,{className:"pt-0",children:R||u?e.jsx(h,{}):$.length>0?e.jsx(t.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(ke,{data:$})}):e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:"No data available"})})]})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"Product Summary"})}),e.jsx(_,{className:"p-0",children:S||u?e.jsx("div",{className:"p-4 space-y-2",children:[1,2,3,4,5].map(a=>e.jsxs("div",{className:"flex items-center gap-3 py-2",children:[e.jsx(p,{className:"w-6 h-6 rounded-full"}),e.jsx(p,{className:"h-4 w-40 flex-1"}),e.jsx(p,{className:"h-4 w-20"})]},a))}):i.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(A,{className:"hover:bg-transparent",children:[e.jsx(v,{className:"w-12",children:"#"}),e.jsx(v,{children:"Product"}),e.jsx(v,{className:"text-right w-24",children:"Units"}),e.jsx(v,{className:"text-right w-28",children:"Avg Price"}),e.jsx(v,{className:"text-right w-32",children:"Total"})]})}),e.jsx(Z,{children:i.map((a,l)=>{const n=a.units_sold>0?a.total_amount/a.units_sold:0;return e.jsxs(A,{children:[e.jsx(w,{className:"font-medium text-muted-foreground",children:l+1}),e.jsx(w,{className:"font-medium",children:a.display_name}),e.jsx(w,{className:"text-right tabular-nums",children:a.units_sold.toLocaleString()}),e.jsx(w,{className:"text-right tabular-nums text-muted-foreground",children:k(n)}),e.jsx(w,{className:"text-right tabular-nums font-semibold",children:k(a.total_amount)})]},a.product_id||a.group_id||a.display_name)})})]})}):e.jsx("p",{className:"py-8 text-center text-sm text-muted-foreground",children:"No products found"})})]})]})}export{Be as default};
