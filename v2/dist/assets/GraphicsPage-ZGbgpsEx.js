const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BarChartComponent-QJZ19IB9.js","assets/index-DxbtoF3i.js","assets/index-JJ50pviR.css","assets/CategoricalChart-DVHlKiSn.js","assets/AreaChart-CjaWyYpK.js","assets/CartesianChart-NedJ25m8.js","assets/ProductPieChart-DJVKDFms.js","assets/tooltipContext-DdSOh3PL.js","assets/WeekdayBarChart-3qQNy2qo.js","assets/BarChart-_mbq9eEY.js","assets/HotTimeChart-CZw-C0RJ.js","assets/MsfsComparisonCard-CnWPFk14.js"])))=>i.map(i=>d[i]);
import{c as Q,r as a,j as e,e as j,f as xe,S as p,C as h,_ as D}from"./index-DxbtoF3i.js";import{f as ue,o as he,v as fe,w as je,x as pe,E as ye,L as q,I as J,B as K,C as g,c as N,d as b,a as _,b as ge}from"./partnerApi-DKTAbEuZ.js";import{C as Ne}from"./check-C4jE1-fW.js";import{f,s as F}from"./format-DiB1zjxr.js";const be=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],_e=Q("copy",be);const ve=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],we=Q("message-circle",ve),X=a.forwardRef(({className:o,...d},c)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:c,className:j("w-full caption-bottom text-sm",o),...d})}));X.displayName="Table";const Y=a.forwardRef(({className:o,...d},c)=>e.jsx("thead",{ref:c,className:j("[&_tr]:border-b",o),...d}));Y.displayName="TableHeader";const Z=a.forwardRef(({className:o,...d},c)=>e.jsx("tbody",{ref:c,className:j("[&_tr:last-child]:border-0",o),...d}));Z.displayName="TableBody";const Se=a.forwardRef(({className:o,...d},c)=>e.jsx("tfoot",{ref:c,className:j("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",o),...d}));Se.displayName="TableFooter";const A=a.forwardRef(({className:o,...d},c)=>e.jsx("tr",{ref:c,className:j("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",o),...d}));A.displayName="TableRow";const v=a.forwardRef(({className:o,...d},c)=>e.jsx("th",{ref:c,className:j("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",o),...d}));v.displayName="TableHead";const w=a.forwardRef(({className:o,...d},c)=>e.jsx("td",{ref:c,className:j("p-4 align-middle [&:has([role=checkbox])]:pr-0",o),...d}));w.displayName="TableCell";const De=a.forwardRef(({className:o,...d},c)=>e.jsx("caption",{ref:c,className:j("mt-4 text-sm text-muted-foreground",o),...d}));De.displayName="TableCaption";const Ce=a.lazy(()=>D(()=>import("./BarChartComponent-QJZ19IB9.js"),__vite__mapDeps([0,1,2,3,4,5]))),Te=a.lazy(()=>D(()=>import("./ProductPieChart-DJVKDFms.js"),__vite__mapDeps([6,1,2,3,7]))),Me=a.lazy(()=>D(()=>import("./WeekdayBarChart-3qQNy2qo.js"),__vite__mapDeps([8,1,2,3,9,7,5]))),ke=a.lazy(()=>D(()=>import("./HotTimeChart-CZw-C0RJ.js"),__vite__mapDeps([10,1,2,3,9,7,5]))),Re=a.lazy(()=>D(()=>import("./MsfsComparisonCard-CnWPFk14.js"),__vite__mapDeps([11,1,2])));function k(o){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(o)}function Be(){const[o,d]=a.useState(null),[c,ee]=a.useState(null),[m,C]=a.useState(""),[x,T]=a.useState(""),[y,ae]=a.useState(null),[M,te]=a.useState([]),[S,B]=a.useState(!0),[u,se]=a.useState(!0),[I,O]=a.useState(null),[L,z]=a.useState(!1),[V,re]=a.useState([]),[$,le]=a.useState([]),[H,ne]=a.useState([]),[R,U]=a.useState(!1),{toast:oe}=xe();a.useEffect(()=>{async function t(){try{const l=await ge();if(d(l.min_date),ee(l.max_date),l.max_date){const n=new Date(l.max_date),s=f(F(n),"yyyy-MM-dd");C(s),T(l.max_date)}else{const n=new Date;C(f(F(n),"yyyy-MM-dd")),T(f(n,"yyyy-MM-dd"))}}catch(l){console.error("Failed to load date range:",l);const n=new Date;C(f(F(n),"yyyy-MM-dd")),T(f(n,"yyyy-MM-dd"))}finally{se(!1)}}t()},[]);const E=a.useCallback(async()=>{if(!(!m||!x)){B(!0),U(!0),O(null);try{const[t,l,n,s,r]=await Promise.all([ue(m,x),he(),fe(m,x),je(m,x),pe(m,x)]);ae(t),te(l.value||[]),re(n),le(s),ne(r)}catch(t){O(t instanceof Error?t.message:"Failed to load report")}finally{B(!1),U(!1)}}},[m,x]);a.useEffect(()=>{!u&&m&&x&&E()},[E,u,m,x]);const i=a.useMemo(()=>{if(!y?.summary)return[];const t=[...y.summary];return M.length===0?t.sort((l,n)=>n.total_amount-l.total_amount):t.sort((l,n)=>{const s=M.indexOf(l.display_name),r=M.indexOf(n.display_name);return s===-1&&r===-1?n.total_amount-l.total_amount:s===-1?1:r===-1?-1:s-r})},[y?.summary,M]),W=a.useMemo(()=>y?.daily?y.daily.map(t=>({date:f(new Date(t.date),"MMM dd"),sales:t.total_amount})):[],[y]),G=a.useMemo(()=>{if(!i.length)return[];const t=i.reduce((r,P)=>r+P.total_amount,0);if(t===0)return[];const l=i.map(r=>({name:r.display_name,value:r.total_amount,percentage:r.total_amount/t*100})),n=l.filter(r=>r.percentage>=5),s=l.filter(r=>r.percentage<5);if(s.length>0){const r=s.reduce((ie,me)=>ie+me.value,0),P=r/t*100;n.push({name:"Others",value:r,percentage:P})}return n},[i]),ce=()=>{if(!i.length)return;const t=["Product","Total Amount","Units Sold","Avg Amount"],l=i.map(s=>{const r=s.units_sold>0?s.total_amount/s.units_sold:0;return[s.display_name,s.total_amount.toFixed(2),s.units_sold.toString(),r.toFixed(2)]}),n=[t.join("	"),...l.map(s=>s.join("	"))].join(`
`);navigator.clipboard.writeText(n).then(()=>{z(!0),oe({title:"Copied!",description:"Paste into Google Sheets"}),setTimeout(()=>z(!1),2e3)})},de=()=>{if(!i.length)return;const t=i.reduce((s,r)=>s+r.total_amount,0),l=["ðŸ“Š *Sales Report*",`ðŸ“… ${f(new Date(m),"MMM d")} - ${f(new Date(x),"MMM d, yyyy")}`,"",`ðŸ’° *Total: ${k(t)}*`,"",...i.slice(0,10).map((s,r)=>`${r+1}. ${s.display_name}: ${k(s.total_amount)}`)],n=encodeURIComponent(l.join(`
`));window.open(`https://wa.me/?text=${n}`,"_blank")};return I?e.jsx(ye,{message:I,onRetry:E}):e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Reports"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sales report and export"})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"start",className:"text-xs text-muted-foreground",children:"From"}),e.jsx(J,{id:"start",type:"date",value:m,min:o||void 0,max:c||void 0,onChange:t=>C(t.target.value),className:"h-9 w-[140px]"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"end",className:"text-xs text-muted-foreground",children:"To"}),e.jsx(J,{id:"end",type:"date",value:x,min:o||void 0,max:c||void 0,onChange:t=>T(t.target.value),className:"h-9 w-[140px]"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(K,{variant:"secondary",size:"sm",onClick:ce,disabled:S||u||!i.length,children:[L?e.jsx(Ne,{className:"h-4 w-4 mr-2"}):e.jsx(_e,{className:"h-4 w-4 mr-2"}),L?"Copied!":"Copy for Sheets"]}),e.jsxs(K,{variant:"secondary",size:"sm",onClick:de,disabled:S||u||!i.length,children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Send via WhatsApp"]})]})]})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"MSFS 2020 vs 2024"})}),e.jsx(_,{children:R||u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{className:"h-24"}),e.jsx(p,{className:"h-24"})]}),e.jsx(p,{className:"h-3 w-full"})]}):H.length>0?e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"h-32",children:e.jsx(h,{})}),children:e.jsx(Re,{data:H})}):e.jsx("p",{className:"py-8 text-center text-sm text-muted-foreground",children:"No data available"})})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"Daily Sales"})}),e.jsx(_,{className:"pt-0",children:S||u?e.jsx(h,{}):W.length>0?e.jsx(a.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Ce,{data:W})}):e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:"No data available"})})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"Product Distribution"})}),e.jsx(_,{className:"pt-0",children:S||u?e.jsx("div",{className:"h-[280px] flex items-center justify-center",children:e.jsx(p,{className:"h-[180px] w-[180px] rounded-full"})}):G.length>0?e.jsx(a.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Te,{data:G})}):e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:"No data available"})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"Sales by Day of Week"})}),e.jsx(_,{className:"pt-0",children:R||u?e.jsx(h,{}):V.length>0?e.jsx(a.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Me,{data:V})}):e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:"No data available"})})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"Hot Time (UTC)"})}),e.jsx(_,{className:"pt-0",children:R||u?e.jsx(h,{}):$.length>0?e.jsx(a.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(ke,{data:$})}):e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:"No data available"})})]})]}),e.jsxs(g,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-base",children:"Product Summary"})}),e.jsx(_,{className:"p-0",children:S||u?e.jsx("div",{className:"p-4 space-y-2",children:[1,2,3,4,5].map(t=>e.jsxs("div",{className:"flex items-center gap-3 py-2",children:[e.jsx(p,{className:"w-6 h-6 rounded-full"}),e.jsx(p,{className:"h-4 w-40 flex-1"}),e.jsx(p,{className:"h-4 w-20"})]},t))}):i.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(A,{className:"hover:bg-transparent",children:[e.jsx(v,{className:"w-12",children:"#"}),e.jsx(v,{children:"Product"}),e.jsx(v,{className:"text-right w-24",children:"Units"}),e.jsx(v,{className:"text-right w-28",children:"Avg Price"}),e.jsx(v,{className:"text-right w-32",children:"Total"})]})}),e.jsx(Z,{children:i.map((t,l)=>{const n=t.units_sold>0?t.total_amount/t.units_sold:0;return e.jsxs(A,{children:[e.jsx(w,{className:"font-medium text-muted-foreground",children:l+1}),e.jsx(w,{className:"font-medium",children:t.display_name}),e.jsx(w,{className:"text-right tabular-nums",children:t.units_sold.toLocaleString()}),e.jsx(w,{className:"text-right tabular-nums text-muted-foreground",children:k(n)}),e.jsx(w,{className:"text-right tabular-nums font-semibold",children:k(t.total_amount)})]},t.product_id||t.group_id||t.display_name)})})]})}):e.jsx("p",{className:"py-8 text-center text-sm text-muted-foreground",children:"No products found"})})]})]})}export{Be as default};
