import{c as b,r as i,u as De,j as e,a as Me,P as U,b as q,d as Ae,e as F,S as C,f as L,g as Fe,X as J,W as Le}from"./index-m1y0idD7.js";import{u as Re,a as Ve,c as re,R as ze,I as Ge,P as Ue,T as ne,D as Oe,b as Be,d as He,e as qe,f as Ze,g as Xe}from"./dialog-BdBAfi3J.js";import{E as O,C as _,c as T,d as P,e as R,a as E,L as A,I as D,B as k,g as ce,h as ie,i as Ye,j as Ke,u as We,k as Je,l as Qe,s as es,m as ss,n as as,t as ts,R as rs,o as ns,p as cs,T as le,q as Q,r as is}from"./partnerApi-CpOYvPTw.js";import{C as Z}from"./check-CaptvDUB.js";const ls=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],os=b("circle-alert",ls);const ds=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],us=b("circle-check",ds);const ms=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],xs=b("circle-x",ms);const hs=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]],ps=b("file-up",hs);const fs=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],gs=b("file",fs);const vs=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],js=b("grip-vertical",vs);const Ns=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],ys=b("list-ordered",Ns);const bs=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],ws=b("package",bs);const Cs=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ks=b("rotate-ccw",Cs);const Ss=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],oe=b("save",Ss);const _s=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],de=b("search",_s);const Ts=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ue=b("upload",Ts);const Ps=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Es=b("users",Ps);var B="Tabs",[$s]=Me(B,[re]),me=re(),[Is,X]=$s(B),xe=i.forwardRef((s,a)=>{const{__scopeTabs:c,value:l,onValueChange:n,defaultValue:d,orientation:r="horizontal",dir:u,activationMode:o="automatic",...f}=s,m=Re(u),[h,N]=De({prop:l,onChange:n,defaultProp:d??"",caller:B});return e.jsx(Is,{scope:c,baseId:Ve(),value:h,onValueChange:N,orientation:r,dir:m,activationMode:o,children:e.jsx(U.div,{dir:m,"data-orientation":r,...f,ref:a})})});xe.displayName=B;var he="TabsList",pe=i.forwardRef((s,a)=>{const{__scopeTabs:c,loop:l=!0,...n}=s,d=X(he,c),r=me(c);return e.jsx(ze,{asChild:!0,...r,orientation:d.orientation,dir:d.dir,loop:l,children:e.jsx(U.div,{role:"tablist","aria-orientation":d.orientation,...n,ref:a})})});pe.displayName=he;var fe="TabsTrigger",ge=i.forwardRef((s,a)=>{const{__scopeTabs:c,value:l,disabled:n=!1,...d}=s,r=X(fe,c),u=me(c),o=Ne(r.baseId,l),f=ye(r.baseId,l),m=l===r.value;return e.jsx(Ge,{asChild:!0,...u,focusable:!n,active:m,children:e.jsx(U.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":f,"data-state":m?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:o,...d,ref:a,onMouseDown:q(s.onMouseDown,h=>{!n&&h.button===0&&h.ctrlKey===!1?r.onValueChange(l):h.preventDefault()}),onKeyDown:q(s.onKeyDown,h=>{[" ","Enter"].includes(h.key)&&r.onValueChange(l)}),onFocus:q(s.onFocus,()=>{const h=r.activationMode!=="manual";!m&&!n&&h&&r.onValueChange(l)})})})});ge.displayName=fe;var ve="TabsContent",je=i.forwardRef((s,a)=>{const{__scopeTabs:c,value:l,forceMount:n,children:d,...r}=s,u=X(ve,c),o=Ne(u.baseId,l),f=ye(u.baseId,l),m=l===u.value,h=i.useRef(m);return i.useEffect(()=>{const N=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(N)},[]),e.jsx(Ae,{present:n||m,children:({present:N})=>e.jsx(U.div,{"data-state":m?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":o,hidden:!N,id:f,tabIndex:0,...r,ref:a,style:{...s.style,animationDuration:h.current?"0s":void 0},children:N&&d})})});je.displayName=ve;function Ne(s,a){return`${s}-trigger-${a}`}function ye(s,a){return`${s}-content-${a}`}var Ds=xe,be=pe,we=ge,Ce=je;const Ms=Ds,ke=i.forwardRef(({className:s,...a},c)=>e.jsx(be,{ref:c,className:F("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a}));ke.displayName=be.displayName;const $=i.forwardRef(({className:s,...a},c)=>e.jsx(we,{ref:c,className:F("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...a}));$.displayName=we.displayName;const I=i.forwardRef(({className:s,...a},c)=>e.jsx(Ce,{ref:c,className:F("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a}));I.displayName=Ce.displayName;const Y=i.forwardRef(({className:s,checked:a,onCheckedChange:c,...l},n)=>e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",ref:n,checked:a,onChange:d=>c?.(d.target.checked),className:"sr-only peer",...l}),e.jsx("div",{className:F("h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 peer-checked:bg-primary peer-checked:text-primary-foreground flex items-center justify-center",s),children:a&&e.jsx(Z,{className:"h-3 w-3"})})]}));Y.displayName="Checkbox";function H({message:s="Loading...",variant:a="page",count:c=4}){return a==="inline"?e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),e.jsx("span",{className:"text-sm",children:s})]}):a==="cards"?e.jsx("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4 animate-fade-in",children:Array.from({length:c}).map((l,n)=>e.jsxs("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[e.jsx(C,{className:"h-4 w-1/2"}),e.jsx(C,{className:"h-8 w-3/4"})]},n))}):a==="list"?e.jsx("div",{className:"space-y-3 animate-fade-in",children:Array.from({length:c}).map((l,n)=>e.jsxs("div",{className:"rounded-lg border bg-card p-4 flex items-center gap-4",children:[e.jsx(C,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(C,{className:"h-4 w-1/3"}),e.jsx(C,{className:"h-3 w-1/2"})]}),e.jsx(C,{className:"h-8 w-16"})]},n))}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"h-8 w-48"}),e.jsx(C,{className:"h-4 w-64"})]}),e.jsx("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:Array.from({length:4}).map((l,n)=>e.jsxs("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[e.jsx(C,{className:"h-4 w-1/2"}),e.jsx(C,{className:"h-8 w-3/4"})]},n))}),e.jsx("div",{className:"rounded-lg border bg-card p-4",children:e.jsx(C,{className:"h-64 w-full"})})]})}function As(){const[s,a]=i.useState([]),[c,l]=i.useState([]),[n,d]=i.useState(!0),[r,u]=i.useState(null),[o,f]=i.useState(""),[m,h]=i.useState(new Set),[N,j]=i.useState(!1),[v,y]=i.useState(""),{toast:t}=L(),g=async()=>{d(!0),u(null);try{const[p,z]=await Promise.all([ce(),ie()]);a(p),l(z)}catch(p){u(p instanceof Error?p.message:"Failed to load data")}finally{d(!1)}};i.useEffect(()=>{g()},[]);const x=p=>{h(z=>{const M=new Set(z);return M.has(p)?M.delete(p):M.add(p),M})},w=async()=>{if(!o.trim()){t({variant:"destructive",title:"Error",description:"Please enter a group name"});return}if(m.size<2){t({variant:"destructive",title:"Error",description:"Select at least 2 products to create a group"});return}j(!0);try{await Ye(o.trim(),Array.from(m)),t({title:"Success",description:`Group "${o}" created with ${m.size} products`}),f(""),h(new Set),await g()}catch(p){t({variant:"destructive",title:"Error",description:p instanceof Error?p.message:"Failed to create group"})}finally{j(!1)}},S=s.filter(p=>p.group_id===null).filter(p=>p.product_name.toLowerCase().includes(v.toLowerCase())||p.label&&p.label.toLowerCase().includes(v.toLowerCase()));return n?e.jsx(H,{message:"Loading products and groups..."}):r?e.jsx(O,{message:r,onRetry:g}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(_,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"Create New Group"}),e.jsx(R,{children:"Select at least 2 ungrouped products to create a group"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"groupName",children:"Group Name"}),e.jsx(D,{id:"groupName",value:o,onChange:p=>f(p.target.value),placeholder:"Enter group name..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{children:["Select Products (",m.size," selected)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Search products...",value:v,onChange:p=>y(p.target.value),className:"pl-9 mb-2"})]}),e.jsx("div",{className:"max-h-[300px] overflow-auto rounded-md border p-4 space-y-2",children:S.length>0?S.map(p=>e.jsxs("div",{className:"flex items-center space-x-3 rounded-md p-2 hover:bg-accent/50",children:[e.jsx(Y,{id:p.product_id,checked:m.has(p.product_id),onCheckedChange:()=>x(p.product_id)}),e.jsxs("label",{htmlFor:p.product_id,className:"flex-1 cursor-pointer text-sm",children:[e.jsx("span",{className:"font-medium",children:p.label||p.product_name}),e.jsxs("span",{className:"ml-2 text-muted-foreground",children:["(",p.lever,")"]})]})]},p.product_id)):e.jsx("p",{className:"py-4 text-center text-muted-foreground",children:v?"No products found matching search":"All products are already grouped"})})]}),e.jsxs(k,{onClick:w,disabled:N||m.size<2||!o.trim(),className:"w-full",children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Create Group"]})]})]}),e.jsxs(_,{children:[e.jsx(T,{children:e.jsxs(P,{children:["Existing Groups (",c.length,")"]})}),e.jsx(E,{children:c.length>0?e.jsx("div",{className:"space-y-2",children:c.map(p=>{const z=s.filter(M=>M.group_id===p.id);return e.jsx("div",{className:"flex items-center justify-between rounded-md border p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:p.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[z.length," products"]})]})},p.id)})}):e.jsx("p",{className:"py-4 text-center text-muted-foreground",children:"No groups created yet"})})]})]})}function Fs(s,a=[]){let c=[];function l(d,r){const u=i.createContext(r);u.displayName=d+"Context";const o=c.length;c=[...c,r];const f=h=>{const{scope:N,children:j,...v}=h,y=N?.[s]?.[o]||u,t=i.useMemo(()=>v,Object.values(v));return e.jsx(y.Provider,{value:t,children:j})};f.displayName=d+"Provider";function m(h,N){const j=N?.[s]?.[o]||u,v=i.useContext(j);if(v)return v;if(r!==void 0)return r;throw new Error(`\`${h}\` must be used within \`${d}\``)}return[f,m]}const n=()=>{const d=c.map(r=>i.createContext(r));return function(u){const o=u?.[s]||d;return i.useMemo(()=>({[`__scope${s}`]:{...u,[s]:o}}),[u,o])}};return n.scopeName=s,[l,Ls(n,...a)]}function Ls(...s){const a=s[0];if(s.length===1)return a;const c=()=>{const l=s.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(d){const r=l.reduce((u,{useScope:o,scopeName:f})=>{const h=o(d)[`__scope${f}`];return{...u,...h}},{});return i.useMemo(()=>({[`__scope${a.scopeName}`]:r}),[r])}};return c.scopeName=a.scopeName,c}var Rs=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Se=Rs.reduce((s,a)=>{const c=Ke(`Primitive.${a}`),l=i.forwardRef((n,d)=>{const{asChild:r,...u}=n,o=r?c:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(o,{...u,ref:d})});return l.displayName=`Primitive.${a}`,{...s,[a]:l}},{}),K="Progress",W=100,[Vs]=Fs(K),[zs,Gs]=Vs(K),_e=i.forwardRef((s,a)=>{const{__scopeProgress:c,value:l=null,max:n,getValueLabel:d=Us,...r}=s;(n||n===0)&&!ee(n)&&console.error(Os(`${n}`,"Progress"));const u=ee(n)?n:W;l!==null&&!se(l,u)&&console.error(Bs(`${l}`,"Progress"));const o=se(l,u)?l:null,f=G(o)?d(o,u):void 0;return e.jsx(zs,{scope:c,value:o,max:u,children:e.jsx(Se.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":G(o)?o:void 0,"aria-valuetext":f,role:"progressbar","data-state":Ee(o,u),"data-value":o??void 0,"data-max":u,...r,ref:a})})});_e.displayName=K;var Te="ProgressIndicator",Pe=i.forwardRef((s,a)=>{const{__scopeProgress:c,...l}=s,n=Gs(Te,c);return e.jsx(Se.div,{"data-state":Ee(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...l,ref:a})});Pe.displayName=Te;function Us(s,a){return`${Math.round(s/a*100)}%`}function Ee(s,a){return s==null?"indeterminate":s===a?"complete":"loading"}function G(s){return typeof s=="number"}function ee(s){return G(s)&&!isNaN(s)&&s>0}function se(s,a){return G(s)&&!isNaN(s)&&s<=a&&s>=0}function Os(s,a){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${a}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${W}\`.`}function Bs(s,a){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${a}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${W} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var $e=_e,Hs=Pe;const Ie=i.forwardRef(({className:s,value:a,...c},l)=>e.jsx($e,{ref:l,className:F("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...c,children:e.jsx(Hs,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));Ie.displayName=$e.displayName;function qs(){const[s,a]=i.useState(null),[c,l]=i.useState(!1),[n,d]=i.useState(0),[r,u]=i.useState(null),o=i.useRef(null),{toast:f}=L(),m=j=>{const v=j.target.files?.[0];if(v){const y=[".csv",".zip"],t=v.name.toLowerCase().slice(v.name.lastIndexOf("."));if(!y.includes(t)){f({variant:"destructive",title:"Invalid file type",description:"Please upload a CSV or ZIP file"});return}a(v),u(null),d(0)}},h=async()=>{if(s){l(!0),u(null),d(0);try{const j=await We(s,v=>{d(v)});u(j),f({title:"Upload Complete",description:`Processed ${j.processed} records, inserted ${j.inserted}`})}catch(j){f({variant:"destructive",title:"Upload Failed",description:j instanceof Error?j.message:"Failed to upload file"})}finally{l(!1)}}},N=()=>{a(null),u(null),d(0),o.current&&(o.current.value="")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(_,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"Upload Transactions"}),e.jsx(R,{children:"Upload CSV or ZIP files containing transaction data"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("input",{type:"file",ref:o,onChange:m,accept:".csv,.zip",className:"hidden"}),s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gs,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(s.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:N,disabled:c,children:"Remove"}),e.jsxs(k,{size:"sm",onClick:h,disabled:c,children:[e.jsx(ps,{className:"mr-2 h-4 w-4"}),c?"Uploading...":"Upload"]})]})]}),c&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Uploading..."}),e.jsxs("span",{className:"font-medium tabular-nums",children:[n,"%"]})]}),e.jsx(Ie,{value:n,className:"h-2"}),n===100&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processing file on server..."})]})]}):e.jsxs("div",{onClick:()=>o.current?.click(),className:"flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-border p-12 transition-colors hover:border-primary/50 hover:bg-accent/50",children:[e.jsx(ue,{className:"h-10 w-10 text-muted-foreground"}),e.jsx("p",{className:"mt-4 font-medium",children:"Click to upload"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"CSV or ZIP files (max 50MB)"})]})]})]}),r&&e.jsxs(_,{children:[e.jsx(T,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[r.errors&&r.errors.length>0?e.jsx(xs,{className:"h-5 w-5 text-destructive"}):e.jsx(us,{className:"h-5 w-5 text-primary"}),"Upload Result"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processed"}),e.jsx("p",{className:"text-2xl font-bold",children:r.processed})]}),r.tracked!==void 0&&e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tracked"}),e.jsx("p",{className:"text-2xl font-bold",children:r.tracked})]}),e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inserted"}),e.jsx("p",{className:"text-2xl font-bold",children:r.inserted})]}),r.csv_files_processed!==void 0&&e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"CSV Files"}),e.jsx("p",{className:"text-2xl font-bold",children:r.csv_files_processed})]}),r.latest_date&&e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Latest Date"}),e.jsx("p",{className:"text-lg font-bold",children:r.latest_date})]})]}),r.errors&&r.errors.length>0&&e.jsxs("div",{className:"rounded-lg border border-destructive/20 bg-destructive/5 p-4",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Errors"}),e.jsx("ul",{className:"mt-2 list-inside list-disc space-y-1 text-sm text-muted-foreground",children:r.errors.map((j,v)=>e.jsx("li",{children:j},v))})]})]})]})]})}function ae(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s)}function Zs(){const[s,a]=i.useState([]),[c,l]=i.useState(!0),[n,d]=i.useState(!1),[r,u]=i.useState(null),{toast:o}=L(),[f,m]=i.useState(new Date().getFullYear().toString()),[h,N]=i.useState(""),[j,v]=i.useState(""),y=async()=>{l(!0),u(null);try{const x=await Je();a(Array.isArray(x)?x:[])}catch(x){u(x instanceof Error?x.message:"Failed to load initial cash data")}finally{l(!1)}};i.useEffect(()=>{y()},[]);const t=async()=>{const x=parseInt(f,10),w=parseFloat(h);if(isNaN(x)||x<2e3||x>2100){o({variant:"destructive",title:"Invalid year"});return}if(isNaN(w)){o({variant:"destructive",title:"Invalid amount"});return}d(!0);try{await es(x,w,j||void 0),o({title:"Saved",description:`Initial cash for ${x} set to ${ae(w)}`}),N(""),v(""),y()}catch(V){o({variant:"destructive",title:"Error",description:V instanceof Error?V.message:"Failed to save"})}finally{d(!1)}},g=async x=>{if(confirm(`Delete initial cash for ${x}?`))try{await Qe(x),o({title:"Deleted",description:`Initial cash for ${x} removed`}),y()}catch(w){o({variant:"destructive",title:"Error",description:w instanceof Error?w.message:"Failed to delete"})}};return c?e.jsx(H,{message:"Loading balance settings..."}):r?e.jsx(O,{message:r,onRetry:y}):e.jsx("div",{className:"space-y-6",children:e.jsxs(_,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"Initial Cash (Caixa Inicial)"}),e.jsx(R,{children:"Define the starting cash balance for each year. This is added to the first month's revenue in Balance calculations."})]}),e.jsxs(E,{className:"space-y-6",children:[s.length>0&&e.jsx("div",{className:"rounded-lg border divide-y",children:s.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:x.year}),e.jsx("span",{className:"ml-4 text-lg font-mono",children:ae(x.amount)}),x.note&&e.jsxs("span",{className:"ml-4 text-sm text-muted-foreground",children:["(",x.note,")"]})]}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>g(x.year),children:e.jsx(ne,{className:"h-4 w-4 text-destructive"})})]},x.year))}),s.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No initial cash defined yet. Add one below."}),e.jsxs("div",{className:"pt-4 border-t space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Add or Update Initial Cash"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"ic-year",children:"Year"}),e.jsx(D,{id:"ic-year",type:"number",min:"2000",max:"2100",value:f,onChange:x=>m(x.target.value)})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"ic-amount",children:"Amount ($)"}),e.jsx(D,{id:"ic-amount",type:"number",step:"0.01",placeholder:"0.00",value:h,onChange:x=>N(x.target.value)})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx(A,{htmlFor:"ic-note",children:"Note (optional)"}),e.jsx(D,{id:"ic-note",placeholder:"e.g. Carried from 2025",value:j,onChange:x=>v(x.target.value)})]}),e.jsx("div",{children:e.jsxs(k,{onClick:t,disabled:n,className:"w-full",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),n?"Saving...":"Save"]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If a year already exists, it will be updated with the new value."})]})]})]})})}const Xs=Fe("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function te({className:s,variant:a,...c}){return e.jsx("div",{className:F(Xs({variant:a}),s),...c})}function Ys(){const[s,a]=i.useState([]),[c,l]=i.useState(!0),[n,d]=i.useState(null),[r,u]=i.useState(""),[o,f]=i.useState(new Set),{toast:m}=L(),h=async()=>{l(!0),d(null);try{const t=await ss();a(t)}catch(t){d(t instanceof Error?t.message:"Failed to load products")}finally{l(!1)}};i.useEffect(()=>{h()},[]);const N=async t=>{f(g=>new Set(g).add(t.product_id));try{t.is_tracked?(await as(t.product_id),m({title:"Success",description:`"${t.product_name}" is no longer tracked`})):(await ts(t.product_id),m({title:"Success",description:`"${t.product_name}" is now being tracked`})),await h()}catch(g){m({variant:"destructive",title:"Error",description:g instanceof Error?g.message:"Failed to update tracking"})}finally{f(g=>{const x=new Set(g);return x.delete(t.product_id),x})}},j=s.filter(t=>t.product_name.toLowerCase().includes(r.toLowerCase())||t.lever&&t.lever.toLowerCase().includes(r.toLowerCase())||t.product_id.toLowerCase().includes(r.toLowerCase())),v=s.filter(t=>t.is_tracked).length,y=s.length-v;return c?e.jsx(H,{message:"Loading products..."}):n?e.jsx(O,{message:n,onRetry:h}):e.jsx("div",{className:"space-y-6",children:e.jsxs(_,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"Product Tracking"}),e.jsx(R,{children:"Manage which products are tracked in reports and analytics. Products are automatically discovered when you upload CSV files."})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"font-medium",children:[v," Tracked"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:[y," Not Tracked"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-medium",children:[s.length," Total"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Search by product name, lever, or ID...",value:r,onChange:t=>u(t.target.value),className:"pl-9"})]}),e.jsx("div",{className:"max-h-[500px] overflow-auto rounded-md border",children:j.length>0?e.jsx("div",{className:"divide-y",children:j.map(t=>{const g=o.has(t.product_id);return e.jsxs("div",{className:"flex items-center gap-3 p-3 hover:bg-accent/50 transition-colors",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Y,{id:`track-${t.id}`,checked:t.is_tracked,disabled:g,onCheckedChange:()=>N(t)})}),e.jsxs("label",{htmlFor:`track-${t.id}`,className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:t.product_name}),t.is_tracked?e.jsx(te,{variant:"default",className:"text-xs bg-green-600",children:"Tracked"}):e.jsx(te,{variant:"secondary",className:"text-xs",children:"Not Tracked"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-0.5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Lever:"})," ",t.lever||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",t.product_id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Last seen:"})," ",new Date(t.last_seen_at).toLocaleDateString()]})]})]}),e.jsx("div",{children:e.jsx(k,{size:"sm",variant:t.is_tracked?"outline":"default",disabled:g,onClick:()=>N(t),children:g?"Processing...":t.is_tracked?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),"Stop Tracking"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Track"]})})})]},t.id)})}):e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:r?"No products found matching search":"No products discovered yet. Upload a CSV to discover products."})})})]})]})})}function Ks(){const[s,a]=i.useState([]),[c,l]=i.useState(!0),[n,d]=i.useState(!1),[r,u]=i.useState(null),[o,f]=i.useState(null),{toast:m}=L(),h=async()=>{l(!0),u(null);try{const[t,g,x]=await Promise.all([ns(),ce(),ie()]);if(t.value&&t.value.length>0)a(t.value);else{const w=x.map(S=>S.name),V=g.filter(S=>!S.group_id).map(S=>S.label||S.product_name);a([...w,...V])}}catch(t){u(t instanceof Error?t.message:"Failed to load sort order")}finally{l(!1)}};i.useEffect(()=>{h()},[]);const N=t=>{f(t)},j=(t,g)=>{if(t.preventDefault(),o===null||o===g)return;const x=[...s],[w]=x.splice(o,1);x.splice(g,0,w),a(x),f(g)},v=()=>{f(null)},y=async()=>{d(!0);try{await cs(s),m({title:"Success",description:"Sort order saved"})}catch(t){m({variant:"destructive",title:"Error",description:t instanceof Error?t.message:"Failed to save sort order"})}finally{d(!1)}};return c?e.jsx(H,{message:"Loading sort order..."}):r?e.jsx(O,{message:r,onRetry:h}):e.jsxs(_,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"Sort Order"}),e.jsx(R,{children:"Drag items to reorder how they appear in reports"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border divide-y",children:s.map((t,g)=>e.jsxs("div",{draggable:!0,onDragStart:()=>N(g),onDragOver:x=>j(x,g),onDragEnd:v,className:`flex items-center gap-3 p-3 cursor-move transition-colors ${o===g?"bg-accent":"hover:bg-accent/50"}`,children:[e.jsx(js,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm text-muted-foreground w-6",children:g+1}),e.jsx("span",{className:"flex-1 font-medium",children:t})]},`${t}-${g}`))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:y,disabled:n,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),n?"Saving...":"Save Order"]}),e.jsxs(k,{variant:"outline",onClick:h,children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]})]})}function Ws({open:s,onOpenChange:a,title:c,description:l,children:n,footer:d}){return e.jsx(Oe,{open:s,onOpenChange:a,children:e.jsxs(Be,{className:"sm:max-w-[500px]",children:[e.jsxs(He,{children:[e.jsx(qe,{children:c}),l&&e.jsx(Ze,{children:l})]}),e.jsx("div",{className:"py-4",children:n}),d&&e.jsx(Xe,{children:d})]})})}function Js(){const[s,a]=i.useState(null),[c,l]=i.useState(""),[n,d]=i.useState(!1),{toast:r}=L(),u=[{id:"clear_transactions",title:"Clear Transactions",description:"Delete all transaction records. This cannot be undone.",confirmText:"DELETE",action:async()=>{await Q("transactions")}},{id:"clear_audit",title:"Clear Audit Logs",description:"Delete all audit log entries. This cannot be undone.",confirmText:"DELETE",action:async()=>{await Q("audit_logs")}},{id:"reset_all",title:"Reset All Data",description:"Delete ALL data including products, groups, and transactions. This is a complete factory reset.",confirmText:"RESET",action:async()=>{await is()}}],o=async()=>{if(s){if(c!==s.confirmText){r({variant:"destructive",title:"Confirmation failed",description:`Please type "${s.confirmText}" to confirm`});return}d(!0);try{await s.action(),r({title:"Success",description:`${s.title} completed`}),f()}catch(m){r({variant:"destructive",title:"Error",description:m instanceof Error?m.message:"Action failed"})}finally{d(!1)}}},f=()=>{a(null),l("")};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{className:"border-destructive/30",children:[e.jsxs(T,{children:[e.jsxs(P,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(le,{className:"h-5 w-5"}),"Danger Zone"]}),e.jsx(R,{children:"Irreversible actions that affect your data. Use with extreme caution."})]}),e.jsx(E,{className:"space-y-4",children:u.map(m=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-destructive/20 bg-destructive/5 p-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.description})]}),e.jsxs(k,{variant:"destructive",size:"sm",onClick:()=>a(m),children:[m.id==="reset_all"?e.jsx(ks,{className:"mr-2 h-4 w-4"}):e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Execute"]})]},m.id))})]}),e.jsx(Ws,{open:!!s,onOpenChange:m=>!m&&f(),title:`Confirm: ${s?.title}`,description:"This action cannot be undone. Please read carefully.",footer:e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"outline",onClick:f,disabled:n,children:"Cancel"}),e.jsx(k,{variant:"destructive",onClick:o,disabled:n||c!==s?.confirmText,children:n?"Executing...":"Confirm"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg bg-destructive/10 p-4",children:e.jsxs("p",{className:"text-sm text-destructive",children:[e.jsx("strong",{children:"Warning:"})," ",s?.description]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{htmlFor:"confirm",children:["Type ",e.jsx("strong",{children:s?.confirmText})," to confirm"]}),e.jsx(D,{id:"confirm",value:c,onChange:m=>l(m.target.value),placeholder:s?.confirmText,className:"font-mono"})]})]})})]})}function ta(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage groups, upload data, and configure settings"})]}),e.jsxs(Ms,{defaultValue:"groups",className:"w-full",children:[e.jsxs(ke,{className:"grid w-full max-w-[900px] grid-cols-6",children:[e.jsxs($,{value:"groups",className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Groups"})]}),e.jsxs($,{value:"products",className:"flex items-center gap-2",children:[e.jsx(ws,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Products"})]}),e.jsxs($,{value:"upload",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Upload"})]}),e.jsxs($,{value:"balance",className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Balance"})]}),e.jsxs($,{value:"sort",className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sort"})]}),e.jsxs($,{value:"danger",className:"flex items-center gap-2 text-destructive data-[state=active]:text-destructive",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Danger"})]})]}),e.jsx(I,{value:"groups",className:"mt-6",children:e.jsx(As,{})}),e.jsx(I,{value:"products",className:"mt-6",children:e.jsx(Ys,{})}),e.jsx(I,{value:"upload",className:"mt-6",children:e.jsx(qs,{})}),e.jsx(I,{value:"balance",className:"mt-6",children:e.jsx(Zs,{})}),e.jsx(I,{value:"sort",className:"mt-6",children:e.jsx(Ks,{})}),e.jsx(I,{value:"danger",className:"mt-6",children:e.jsx(Js,{})})]})]})}export{ta as default};
