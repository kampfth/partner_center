import{c as D,r as n,u as Ys,j as e,a as Ie,P as se,b as X,d as Ws,e as P,f as Re,g as W,h as Zs,X as ie,W as Ks}from"./index-Le8Y4Y77.js";import{u as Xs,a as Js,c as Le,R as Qs,I as et,b as Me,d as st,T as tt,P as at,W as rt,C as nt,e as it,D as lt,f as Fe,O as ot,g as _e,h as pe,i as ct,j as oe,k as ce,l as de,m as ue,n as ze,S as dt,o as ut,p as mt,q as xt,r as De,s as me}from"./select-BA3StZho.js";import{S as E,d as Oe,E as te,C as z,e as O,g as V,h as Z,a as U,L as $,I as M,B as b,i as Ve,j as Ue,k as pt,l as ht,T as he,u as gt,m as ft,n as vt,s as jt,P as Nt,o as yt,p as bt,q as wt,t as Ae,r as Pe,v as Ct,R as St,w as kt,x as _t,y as K,z as Dt,A as At}from"./partnerApi-DoUV8bt6.js";import{C as J}from"./check-DwQZA-V6.js";const Pt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Tt=D("calendar",Pt);const Et=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],$t=D("circle-alert",Et);const It=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Rt=D("circle-check",It);const Lt=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Mt=D("download",Lt);const Ft=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]],zt=D("file-up",Ft);const Ot=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],Vt=D("file",Ot);const Ut=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Gt=D("grip-vertical",Ut);const qt=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],Bt=D("list-ordered",qt);const Ht=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Yt=D("package",Ht);const Wt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Zt=D("rotate-ccw",Wt);const Kt=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ge=D("save",Kt);const Xt=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],qe=D("search",Xt);const Jt=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Qt=D("square-check-big",Jt);const ea=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],sa=D("square",ea);const ta=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ge=D("upload",ta);const aa=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],xe=D("users",aa);var ae="Tabs",[ra]=Ie(ae,[Le]),Be=Le(),[na,fe]=ra(ae),He=n.forwardRef((s,t)=>{const{__scopeTabs:a,value:l,onValueChange:i,defaultValue:d,orientation:o="horizontal",dir:u,activationMode:c="automatic",...g}=s,f=Xs(u),[h,m]=Ys({prop:l,onChange:i,defaultProp:d??"",caller:ae});return e.jsx(na,{scope:a,baseId:Js(),value:h,onValueChange:m,orientation:o,dir:f,activationMode:c,children:e.jsx(se.div,{dir:f,"data-orientation":o,...g,ref:t})})});He.displayName=ae;var Ye="TabsList",We=n.forwardRef((s,t)=>{const{__scopeTabs:a,loop:l=!0,...i}=s,d=fe(Ye,a),o=Be(a);return e.jsx(Qs,{asChild:!0,...o,orientation:d.orientation,dir:d.dir,loop:l,children:e.jsx(se.div,{role:"tablist","aria-orientation":d.orientation,...i,ref:t})})});We.displayName=Ye;var Ze="TabsTrigger",Ke=n.forwardRef((s,t)=>{const{__scopeTabs:a,value:l,disabled:i=!1,...d}=s,o=fe(Ze,a),u=Be(a),c=Qe(o.baseId,l),g=es(o.baseId,l),f=l===o.value;return e.jsx(et,{asChild:!0,...u,focusable:!i,active:f,children:e.jsx(se.button,{type:"button",role:"tab","aria-selected":f,"aria-controls":g,"data-state":f?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:c,...d,ref:t,onMouseDown:X(s.onMouseDown,h=>{!i&&h.button===0&&h.ctrlKey===!1?o.onValueChange(l):h.preventDefault()}),onKeyDown:X(s.onKeyDown,h=>{[" ","Enter"].includes(h.key)&&o.onValueChange(l)}),onFocus:X(s.onFocus,()=>{const h=o.activationMode!=="manual";!f&&!i&&h&&o.onValueChange(l)})})})});Ke.displayName=Ze;var Xe="TabsContent",Je=n.forwardRef((s,t)=>{const{__scopeTabs:a,value:l,forceMount:i,children:d,...o}=s,u=fe(Xe,a),c=Qe(u.baseId,l),g=es(u.baseId,l),f=l===u.value,h=n.useRef(f);return n.useEffect(()=>{const m=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(m)},[]),e.jsx(Ws,{present:i||f,children:({present:m})=>e.jsx(se.div,{"data-state":f?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":c,hidden:!m,id:g,tabIndex:0,...o,ref:t,style:{...s.style,animationDuration:h.current?"0s":void 0},children:m&&d})})});Je.displayName=Xe;function Qe(s,t){return`${s}-trigger-${t}`}function es(s,t){return`${s}-content-${t}`}var ia=He,ss=We,ts=Ke,as=Je;const la=ia,rs=n.forwardRef(({className:s,...t},a)=>e.jsx(ss,{ref:a,className:P("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));rs.displayName=ss.displayName;const q=n.forwardRef(({className:s,...t},a)=>e.jsx(ts,{ref:a,className:P("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...t}));q.displayName=ts.displayName;const B=n.forwardRef(({className:s,...t},a)=>e.jsx(as,{ref:a,className:P("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));B.displayName=as.displayName;const Q=n.forwardRef(({className:s,checked:t,onCheckedChange:a,...l},i)=>e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",ref:i,checked:t,onChange:d=>a?.(d.target.checked),className:"sr-only peer",...l}),e.jsx("div",{className:P("h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 peer-checked:bg-primary peer-checked:text-primary-foreground flex items-center justify-center",s),children:t&&e.jsx(J,{className:"h-3 w-3"})})]}));Q.displayName="Checkbox";function re({message:s="Loading...",variant:t="page",count:a=4}){return t==="inline"?e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),e.jsx("span",{className:"text-sm",children:s})]}):t==="cards"?e.jsx("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4 animate-fade-in",children:Array.from({length:a}).map((l,i)=>e.jsxs("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[e.jsx(E,{className:"h-4 w-1/2"}),e.jsx(E,{className:"h-8 w-3/4"})]},i))}):t==="list"?e.jsx("div",{className:"space-y-3 animate-fade-in",children:Array.from({length:a}).map((l,i)=>e.jsxs("div",{className:"rounded-lg border bg-card p-4 flex items-center gap-4",children:[e.jsx(E,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(E,{className:"h-4 w-1/3"}),e.jsx(E,{className:"h-3 w-1/2"})]}),e.jsx(E,{className:"h-8 w-16"})]},i))}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{className:"h-8 w-48"}),e.jsx(E,{className:"h-4 w-64"})]}),e.jsx("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:Array.from({length:4}).map((l,i)=>e.jsxs("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[e.jsx(E,{className:"h-4 w-1/2"}),e.jsx(E,{className:"h-8 w-3/4"})]},i))}),e.jsx("div",{className:"rounded-lg border bg-card p-4",children:e.jsx(E,{className:"h-64 w-full"})})]})}var oa=Symbol("radix.slottable");function ca(s){const t=({children:a})=>e.jsx(e.Fragment,{children:a});return t.displayName=`${s}.Slottable`,t.__radixId=oa,t}var ns="AlertDialog",[da]=Ie(ns,[Me]),F=Me(),is=s=>{const{__scopeAlertDialog:t,...a}=s,l=F(t);return e.jsx(st,{...l,...a,modal:!0})};is.displayName=ns;var ua="AlertDialogTrigger",ls=n.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...l}=s,i=F(a);return e.jsx(tt,{...i,...l,ref:t})});ls.displayName=ua;var ma="AlertDialogPortal",os=s=>{const{__scopeAlertDialog:t,...a}=s,l=F(t);return e.jsx(at,{...l,...a})};os.displayName=ma;var xa="AlertDialogOverlay",cs=n.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...l}=s,i=F(a);return e.jsx(ot,{...i,...l,ref:t})});cs.displayName=xa;var Y="AlertDialogContent",[pa,ha]=da(Y),ga=ca("AlertDialogContent"),ds=n.forwardRef((s,t)=>{const{__scopeAlertDialog:a,children:l,...i}=s,d=F(a),o=n.useRef(null),u=Re(t,o),c=n.useRef(null);return e.jsx(rt,{contentName:Y,titleName:us,docsSlug:"alert-dialog",children:e.jsx(pa,{scope:a,cancelRef:c,children:e.jsxs(nt,{role:"alertdialog",...d,...i,ref:u,onOpenAutoFocus:X(i.onOpenAutoFocus,g=>{g.preventDefault(),c.current?.focus({preventScroll:!0})}),onPointerDownOutside:g=>g.preventDefault(),onInteractOutside:g=>g.preventDefault(),children:[e.jsx(ga,{children:l}),e.jsx(va,{contentRef:o})]})})})});ds.displayName=Y;var us="AlertDialogTitle",ms=n.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...l}=s,i=F(a);return e.jsx(it,{...i,...l,ref:t})});ms.displayName=us;var xs="AlertDialogDescription",ps=n.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...l}=s,i=F(a);return e.jsx(lt,{...i,...l,ref:t})});ps.displayName=xs;var fa="AlertDialogAction",hs=n.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...l}=s,i=F(a);return e.jsx(Fe,{...i,...l,ref:t})});hs.displayName=fa;var gs="AlertDialogCancel",fs=n.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...l}=s,{cancelRef:i}=ha(gs,a),d=F(a),o=Re(t,i);return e.jsx(Fe,{...d,...l,ref:o})});fs.displayName=gs;var va=({contentRef:s})=>{const t=`\`${Y}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Y}\` by passing a \`${xs}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Y}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return n.useEffect(()=>{document.getElementById(s.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,s]),null},ja=is,Na=ls,ya=os,vs=cs,js=ds,Ns=hs,ys=fs,bs=ms,ws=ps;const ba=ja,wa=Na,Ca=ya,Cs=n.forwardRef(({className:s,...t},a)=>e.jsx(vs,{className:P("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));Cs.displayName=vs.displayName;const Ss=n.forwardRef(({className:s,...t},a)=>e.jsxs(Ca,{children:[e.jsx(Cs,{}),e.jsx(js,{ref:a,className:P("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));Ss.displayName=js.displayName;const ks=({className:s,...t})=>e.jsx("div",{className:P("flex flex-col space-y-2 text-center sm:text-left",s),...t});ks.displayName="AlertDialogHeader";const _s=({className:s,...t})=>e.jsx("div",{className:P("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});_s.displayName="AlertDialogFooter";const Ds=n.forwardRef(({className:s,...t},a)=>e.jsx(bs,{ref:a,className:P("text-lg font-semibold",s),...t}));Ds.displayName=bs.displayName;const As=n.forwardRef(({className:s,...t},a)=>e.jsx(ws,{ref:a,className:P("text-sm text-muted-foreground",s),...t}));As.displayName=ws.displayName;const Ps=n.forwardRef(({className:s,...t},a)=>e.jsx(Ns,{ref:a,className:P(Oe(),s),...t}));Ps.displayName=Ns.displayName;const Ts=n.forwardRef(({className:s,...t},a)=>e.jsx(ys,{ref:a,className:P(Oe({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));Ts.displayName=ys.displayName;function Sa(){const[s,t]=n.useState([]),[a,l]=n.useState([]),[i,d]=n.useState(!0),[o,u]=n.useState(null),[c,g]=n.useState(""),[f,h]=n.useState(new Set),[m,y]=n.useState(!1),[j,_]=n.useState(""),{toast:v}=W(),w=async()=>{d(!0),u(null);try{const[p,k]=await Promise.all([Ve(),Ue()]);t(p),l(k)}catch(p){u(p instanceof Error?p.message:"Failed to load data")}finally{d(!1)}};n.useEffect(()=>{w()},[]);const x=p=>{h(k=>{const C=new Set(k);return C.has(p)?C.delete(p):C.add(p),C})},A=async()=>{if(!c.trim()){v({variant:"destructive",title:"Error",description:"Please enter a group name"});return}const p=Array.from(f);if(p.length<2){v({variant:"destructive",title:"Error",description:`Select at least 2 products (currently ${p.length} selected)`});return}y(!0);try{await pt(c.trim(),p),v({title:"Success",description:`Group "${c}" created with ${p.length} products`}),g(""),h(new Set),await w()}catch(k){v({variant:"destructive",title:"Error",description:k instanceof Error?k.message:"Failed to create group"})}finally{y(!1)}},T=s.filter(p=>p.group_id===null).filter(p=>p.product_name.toLowerCase().includes(j.toLowerCase())||p.label&&p.label.toLowerCase().includes(j.toLowerCase())||p.product_id.toLowerCase().includes(j.toLowerCase()));return i?e.jsx(re,{message:"Loading products and groups..."}):o?e.jsx(te,{message:o,onRetry:w}):e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(z,{className:"h-fit",children:[e.jsxs(O,{className:"pb-3",children:[e.jsxs(V,{className:"text-lg flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"Create New Group"]}),e.jsx(Z,{children:"Select at least 2 ungrouped products to create a group"})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"groupName",children:"Group Name"}),e.jsx(M,{id:"groupName",value:c,onChange:p=>g(p.target.value),placeholder:"Enter group name..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs($,{children:["Select Products (",f.size," selected)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search products...",value:j,onChange:p=>_(p.target.value),className:"pl-9"})]}),e.jsx("div",{className:"max-h-[250px] overflow-auto rounded-md border p-2 space-y-1",children:T.length>0?T.map(p=>{const k=`grp-cb-${p.id}`,C=f.has(p.product_id);return e.jsxs("div",{className:`flex items-center space-x-3 rounded-md p-2 cursor-pointer transition-colors ${C?"bg-primary/10":"hover:bg-accent/50"}`,onClick:()=>x(p.product_id),children:[e.jsx(Q,{id:k,checked:C,onCheckedChange:()=>x(p.product_id)}),e.jsxs("label",{htmlFor:k,className:"flex-1 cursor-pointer text-sm",children:[e.jsx("span",{className:"font-medium",children:p.label||p.product_name}),p.lever&&e.jsxs("span",{className:"ml-2 text-muted-foreground text-xs",children:["(",p.lever,")"]})]})]},p.id)}):e.jsx("p",{className:"py-4 text-center text-muted-foreground text-sm",children:j?"No products found":"All products are already grouped"})})]}),e.jsxs(b,{onClick:A,disabled:m||f.size<2||!c.trim(),className:"w-full",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),m?"Creating...":`Create Group (${f.size} products)`]})]})]}),e.jsxs(z,{className:"h-fit",children:[e.jsx(O,{className:"pb-3",children:e.jsxs(V,{className:"text-lg flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Existing Groups (",a.length,")"]})}),e.jsx(U,{children:a.length>0?e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-auto",children:a.map(p=>{const k=s.filter(C=>C.group_id===p.id);return e.jsxs("div",{className:"flex items-center justify-between rounded-md border p-3 hover:bg-accent/30 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:p.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[k.length," product",k.length!==1?"s":""]}),k.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-1",children:k.map(C=>C.label||C.product_name).join(", ")})]}),e.jsxs(ba,{children:[e.jsx(wa,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"icon",className:"ml-2 shrink-0",children:e.jsx(pe,{className:"h-4 w-4 text-destructive"})})}),e.jsxs(Ss,{children:[e.jsxs(ks,{children:[e.jsx(Ds,{children:"Delete Group"}),e.jsxs(As,{children:['Are you sure you want to delete "',p.name,'"? Products in this group will become ungrouped.']})]}),e.jsxs(_s,{children:[e.jsx(Ts,{children:"Cancel"}),e.jsx(Ps,{onClick:async()=>{try{v({title:"Info",description:"Delete functionality coming soon"})}catch{v({variant:"destructive",title:"Error",description:"Failed to delete group"})}},children:"Delete"})]})]})]})]},p.id)})}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(xe,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No groups created yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select products on the left to create your first group"})]})})]})]})}function ka(s,t=[]){let a=[];function l(d,o){const u=n.createContext(o);u.displayName=d+"Context";const c=a.length;a=[...a,o];const g=h=>{const{scope:m,children:y,...j}=h,_=m?.[s]?.[c]||u,v=n.useMemo(()=>j,Object.values(j));return e.jsx(_.Provider,{value:v,children:y})};g.displayName=d+"Provider";function f(h,m){const y=m?.[s]?.[c]||u,j=n.useContext(y);if(j)return j;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${d}\``)}return[g,f]}const i=()=>{const d=a.map(o=>n.createContext(o));return function(u){const c=u?.[s]||d;return n.useMemo(()=>({[`__scope${s}`]:{...u,[s]:c}}),[u,c])}};return i.scopeName=s,[l,_a(i,...t)]}function _a(...s){const t=s[0];if(s.length===1)return t;const a=()=>{const l=s.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(d){const o=l.reduce((u,{useScope:c,scopeName:g})=>{const h=c(d)[`__scope${g}`];return{...u,...h}},{});return n.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return a.scopeName=t.scopeName,a}var Da=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Es=Da.reduce((s,t)=>{const a=ht(`Primitive.${t}`),l=n.forwardRef((i,d)=>{const{asChild:o,...u}=i,c=o?a:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(c,{...u,ref:d})});return l.displayName=`Primitive.${t}`,{...s,[t]:l}},{}),ve="Progress",je=100,[Aa]=ka(ve),[Pa,Ta]=Aa(ve),$s=n.forwardRef((s,t)=>{const{__scopeProgress:a,value:l=null,max:i,getValueLabel:d=Ea,...o}=s;(i||i===0)&&!Te(i)&&console.error($a(`${i}`,"Progress"));const u=Te(i)?i:je;l!==null&&!Ee(l,u)&&console.error(Ia(`${l}`,"Progress"));const c=Ee(l,u)?l:null,g=ee(c)?d(c,u):void 0;return e.jsx(Pa,{scope:a,value:c,max:u,children:e.jsx(Es.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":ee(c)?c:void 0,"aria-valuetext":g,role:"progressbar","data-state":Ls(c,u),"data-value":c??void 0,"data-max":u,...o,ref:t})})});$s.displayName=ve;var Is="ProgressIndicator",Rs=n.forwardRef((s,t)=>{const{__scopeProgress:a,...l}=s,i=Ta(Is,a);return e.jsx(Es.div,{"data-state":Ls(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...l,ref:t})});Rs.displayName=Is;function Ea(s,t){return`${Math.round(s/t*100)}%`}function Ls(s,t){return s==null?"indeterminate":s===t?"complete":"loading"}function ee(s){return typeof s=="number"}function Te(s){return ee(s)&&!isNaN(s)&&s>0}function Ee(s,t){return ee(s)&&!isNaN(s)&&s<=t&&s>=0}function $a(s,t){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${je}\`.`}function Ia(s,t){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${je} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Ms=$s,Ra=Rs;const Fs=n.forwardRef(({className:s,value:t,...a},l)=>e.jsx(Ms,{ref:l,className:P("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...a,children:e.jsx(Ra,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Fs.displayName=Ms.displayName;function La(){const[s,t]=n.useState(null),[a,l]=n.useState(!1),[i,d]=n.useState(0),[o,u]=n.useState(null),c=n.useRef(null),{toast:g}=W(),f=y=>{const j=y.target.files?.[0];if(j){const _=[".csv",".zip"],v=j.name.toLowerCase().slice(j.name.lastIndexOf("."));if(!_.includes(v)){g({variant:"destructive",title:"Invalid file type",description:"Please upload a CSV or ZIP file"});return}t(j),u(null),d(0)}},h=async()=>{if(s){l(!0),u(null),d(0);try{const y=await gt(s,j=>{d(j)});u(y),g({title:"Upload Complete",description:`Rows ${y.rows_read}, inserted ${y.transactions_inserted}, discovered ${y.products_discovered}`})}catch(y){g({variant:"destructive",title:"Upload Failed",description:y instanceof Error?y.message:"Failed to upload file"})}finally{l(!1)}}},m=()=>{t(null),u(null),d(0),c.current&&(c.current.value="")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(z,{children:[e.jsxs(O,{children:[e.jsx(V,{children:"Upload Transactions"}),e.jsx(Z,{children:"Upload CSV or ZIP files containing transaction data"})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsx("input",{type:"file",ref:c,onChange:f,accept:".csv,.zip",className:"hidden"}),s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Vt,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(s.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:m,disabled:a,children:"Remove"}),e.jsxs(b,{size:"sm",onClick:h,disabled:a,children:[e.jsx(zt,{className:"mr-2 h-4 w-4"}),a?"Uploading...":"Upload"]})]})]}),a&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Uploading..."}),e.jsxs("span",{className:"font-medium tabular-nums",children:[i,"%"]})]}),e.jsx(Fs,{value:i,className:"h-2"}),i===100&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processing file on server..."})]})]}):e.jsxs("div",{onClick:()=>c.current?.click(),className:"flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-border p-12 transition-colors hover:border-primary/50 hover:bg-accent/50",children:[e.jsx(ge,{className:"h-10 w-10 text-muted-foreground"}),e.jsx("p",{className:"mt-4 font-medium",children:"Click to upload"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"CSV or ZIP files (max 50MB)"})]})]})]}),o&&e.jsxs(z,{children:[e.jsx(O,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[o.transactions_skipped>0?e.jsx(he,{className:"h-5 w-5 text-warning"}):e.jsx(Rt,{className:"h-5 w-5 text-primary"}),"Upload Result"]})}),e.jsx(U,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processed"}),e.jsx("p",{className:"text-2xl font-bold",children:o.rows_read})]}),e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Products Discovered"}),e.jsx("p",{className:"text-2xl font-bold",children:o.products_discovered})]}),e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inserted"}),e.jsx("p",{className:"text-2xl font-bold",children:o.transactions_inserted})]}),e.jsxs("div",{className:"rounded-lg bg-accent/50 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Untracked"}),e.jsx("p",{className:"text-2xl font-bold",children:o.transactions_untracked})]})]})})]})]})}function $e(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s)}function Ma(){const[s,t]=n.useState([]),[a,l]=n.useState(!0),[i,d]=n.useState(!1),[o,u]=n.useState(null),{toast:c}=W(),[g,f]=n.useState(new Date().getFullYear().toString()),[h,m]=n.useState(""),[y,j]=n.useState(""),_=async()=>{l(!0),u(null);try{const x=await ft();t(Array.isArray(x)?x:[])}catch(x){u(x instanceof Error?x.message:"Failed to load initial cash data")}finally{l(!1)}};n.useEffect(()=>{_()},[]);const v=async()=>{const x=parseInt(g,10),A=parseFloat(h);if(isNaN(x)||x<2e3||x>2100){c({variant:"destructive",title:"Invalid year"});return}if(isNaN(A)){c({variant:"destructive",title:"Invalid amount"});return}d(!0);try{await jt(x,A,y||void 0),c({title:"Saved",description:`Initial cash for ${x} set to ${$e(A)}`}),m(""),j(""),_()}catch(R){c({variant:"destructive",title:"Error",description:R instanceof Error?R.message:"Failed to save"})}finally{d(!1)}},w=async x=>{if(confirm(`Delete initial cash for ${x}?`))try{await vt(x),c({title:"Deleted",description:`Initial cash for ${x} removed`}),_()}catch(A){c({variant:"destructive",title:"Error",description:A instanceof Error?A.message:"Failed to delete"})}};return a?e.jsx(re,{message:"Loading balance settings..."}):o?e.jsx(te,{message:o,onRetry:_}):e.jsx("div",{className:"space-y-6",children:e.jsxs(z,{children:[e.jsxs(O,{children:[e.jsx(V,{children:"Initial Cash (Caixa Inicial)"}),e.jsx(Z,{children:"Define the starting cash balance for each year. This is added to the first month's revenue in Balance calculations."})]}),e.jsxs(U,{className:"space-y-6",children:[s.length>0&&e.jsx("div",{className:"rounded-lg border divide-y",children:s.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:x.year}),e.jsx("span",{className:"ml-4 text-lg font-mono",children:$e(x.amount)}),x.note&&e.jsxs("span",{className:"ml-4 text-sm text-muted-foreground",children:["(",x.note,")"]})]}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>w(x.year),children:e.jsx(pe,{className:"h-4 w-4 text-destructive"})})]},x.year))}),s.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No initial cash defined yet. Add one below."}),e.jsxs("div",{className:"pt-4 border-t space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Add or Update Initial Cash"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"ic-year",children:"Year"}),e.jsx(M,{id:"ic-year",type:"number",min:"2000",max:"2100",value:g,onChange:x=>f(x.target.value)})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"ic-amount",children:"Amount ($)"}),e.jsx(M,{id:"ic-amount",type:"number",step:"0.01",placeholder:"0.00",value:h,onChange:x=>m(x.target.value)})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx($,{htmlFor:"ic-note",children:"Note (optional)"}),e.jsx(M,{id:"ic-note",placeholder:"e.g. Carried from 2025",value:y,onChange:x=>j(x.target.value)})]}),e.jsx("div",{children:e.jsxs(b,{onClick:v,disabled:i,className:"w-full",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),i?"Saving...":"Save"]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If a year already exists, it will be updated with the new value."})]})]})]})})}const Fa=Zs("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function le({className:s,variant:t,...a}){return e.jsx("div",{className:P(Fa({variant:t}),s),...a})}function za(){const[s,t]=n.useState([]),[a,l]=n.useState(!0),[i,d]=n.useState(null),[o,u]=n.useState(""),[c,g]=n.useState(new Set),[f,h]=n.useState(new Set),[m,y]=n.useState(!1),[j,_]=n.useState(null),[v,w]=n.useState(""),[x,A]=n.useState(""),[R,T]=n.useState(!1),[p,k]=n.useState(!1),[C,Ne]=n.useState(null),[zs,ye]=n.useState(!1),be=n.useRef(null),{toast:L}=W(),H=async()=>{l(!0),d(null);try{const r=await yt();t(r),h(new Set)}catch(r){d(r instanceof Error?r.message:"Failed to load products")}finally{l(!1)}};n.useEffect(()=>{H()},[]);const we=async r=>{g(N=>new Set(N).add(r.product_id));try{r.is_tracked?(await Pe(r.product_id),L({title:"Success",description:`"${r.label||r.product_name}" is no longer tracked`})):(await Ae(r.product_id),L({title:"Success",description:`"${r.label||r.product_name}" is now being tracked`})),await H()}catch(N){L({variant:"destructive",title:"Error",description:N instanceof Error?N.message:"Failed to update tracking"})}finally{g(N=>{const S=new Set(N);return S.delete(r.product_id),S})}},Ce=r=>{h(N=>{const S=new Set(N);return S.has(r)?S.delete(r):S.add(r),S})},ne=n.useMemo(()=>s.filter(r=>r.product_name.toLowerCase().includes(o.toLowerCase())||r.lever&&r.lever.toLowerCase().includes(o.toLowerCase())||r.label&&r.label.toLowerCase().includes(o.toLowerCase())||r.product_type&&r.product_type.toLowerCase().includes(o.toLowerCase())||r.product_id.toLowerCase().includes(o.toLowerCase())),[s,o]),Os=()=>{h(new Set(ne.map(r=>r.product_id)))},Vs=()=>{h(new Set)},Se=async r=>{if(f.size===0)return;y(!0);const N=s.filter(G=>f.has(G.product_id));let S=0,I=0;for(const G of N){if(G.is_tracked===r){S++;continue}try{r?await Ae(G.product_id):await Pe(G.product_id),S++}catch{I++}}L({title:I>0?"Partial Success":"Success",description:`${S} product${S!==1?"s":""} ${r?"tracked":"untracked"}${I>0?`, ${I} failed`:""}`,variant:I>0?"destructive":"default"}),await H(),y(!1)},Us=async()=>{if(j){T(!0);try{const r={},N=v.trim();N===""||N===j.product_name?r.label=null:r.label=N,x===""?r.product_type=null:r.product_type=x,await Ct(j.product_id,r),L({title:"Success",description:`Product "${j.product_name}" updated`}),_(null),await H()}catch(r){L({variant:"destructive",title:"Error",description:r instanceof Error?r.message:"Failed to update product"})}finally{T(!1)}}},Gs=()=>{window.open(bt(),"_blank"),L({title:"Export Started",description:"Your product list CSV is being downloaded."})},qs=()=>{be.current?.click()},Bs=async r=>{const N=r.target.files?.[0];if(N){if(r.target.value="",!N.name.toLowerCase().endsWith(".csv")){L({variant:"destructive",title:"Invalid File",description:"Please select a CSV file."});return}ye(!0),Ne(null),k(!0);try{const S=await N.text(),I=await wt(S);Ne(I),I.updated>0&&await H()}catch(S){L({variant:"destructive",title:"Import Failed",description:S instanceof Error?S.message:"Failed to import products"}),k(!1)}finally{ye(!1)}}},ke=s.filter(r=>r.is_tracked).length,Hs=s.length-ke;return a?e.jsx(re,{message:"Loading products..."}):i?e.jsx(te,{message:i,onRetry:H}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(z,{children:[e.jsx(O,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Product Tracking"}),e.jsx(Z,{children:"Manage which products are tracked in reports and analytics."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:Gs,children:[e.jsx(Mt,{className:"h-4 w-4 mr-1"}),"Export"]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:qs,children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Import"]}),e.jsx("input",{type:"file",ref:be,accept:".csv",onChange:Bs,className:"hidden"})]})]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"font-medium",children:[ke," Tracked"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:[Hs," Not Tracked"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-medium",children:[s.length," Total"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(qe,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search by name, label, type, lever, or ID...",value:o,onChange:r=>u(r.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:Os,disabled:m,className:"whitespace-nowrap",children:[e.jsx(Qt,{className:"h-4 w-4 mr-1"}),"Select All"]}),f.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:Vs,disabled:m,children:[e.jsx(sa,{className:"h-4 w-4 mr-1"}),"Clear"]}),e.jsxs(b,{variant:"default",size:"sm",onClick:()=>Se(!0),disabled:m,className:"whitespace-nowrap",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Track (",f.size,")"]}),e.jsxs(b,{variant:"secondary",size:"sm",onClick:()=>Se(!1),disabled:m,className:"whitespace-nowrap",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Untrack (",f.size,")"]})]})]})]}),e.jsx("div",{className:"max-h-[calc(100vh-350px)] min-h-[200px] overflow-auto rounded-md border scrollbar-thin",children:ne.length>0?e.jsx("div",{className:"divide-y",children:ne.map(r=>{const N=c.has(r.product_id),S=f.has(r.product_id),I=`prod-sel-${r.id}`,G=r.label||r.product_name;return e.jsxs("div",{className:`flex items-center gap-3 p-3 transition-colors ${S?"bg-primary/5":"hover:bg-accent/50"}`,children:[e.jsx(Q,{id:I,checked:S,onCheckedChange:()=>Ce(r.product_id),disabled:m}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Q,{id:`track-${r.id}`,checked:r.is_tracked,disabled:N||m,onCheckedChange:()=>we(r)})}),e.jsxs("div",{className:"flex-1 cursor-pointer min-w-0",onClick:()=>Ce(r.product_id),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:G}),r.label&&r.label!==r.product_name&&e.jsxs("span",{className:"text-xs text-muted-foreground truncate max-w-[200px]",title:r.product_name,children:["(",r.product_name,")"]}),r.is_tracked?e.jsx(le,{variant:"default",className:"text-xs bg-green-600 shrink-0",children:"Tracked"}):e.jsx(le,{variant:"secondary",className:"text-xs shrink-0",children:"Not Tracked"}),r.product_type&&e.jsx(le,{variant:"outline",className:"text-xs shrink-0",children:r.product_type})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-0.5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Lever:"})," ",r.lever||"N/A"]}),e.jsxs("div",{className:"truncate",children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",r.product_id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Last seen:"})," ",new Date(r.last_seen_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(b,{size:"sm",variant:"ghost",disabled:N||m,onClick:()=>{_(r),w(r.label||r.product_name),A(r.product_type||"")},title:"Edit label & type",children:e.jsx(ct,{className:"h-3 w-3"})}),e.jsx(b,{size:"sm",variant:r.is_tracked?"outline":"default",disabled:N||m,onClick:()=>we(r),children:N?"...":r.is_tracked?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"Stop"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),"Track"]})})]})]},r.id)})}):e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:o?"No products found matching search":"No products discovered yet. Upload a CSV to discover products."})})})]})]}),e.jsx(oe,{open:!!j,onOpenChange:r=>!r&&_(null),children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(ue,{children:"Edit Product"}),e.jsx(ze,{children:"Update the display label and category for this product."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Original Name"}),e.jsx("p",{className:"text-sm text-muted-foreground break-words",children:j?.product_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"edit-label",children:"Display Label"}),e.jsx(M,{id:"edit-label",value:v,onChange:r=>w(r.target.value),placeholder:"Enter custom label...",maxLength:200}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This label will be shown in reports and dashboards instead of the original name. Leave empty or same as original to use the product name."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"edit-type",children:"Product Type"}),e.jsxs(dt,{value:x,onValueChange:r=>A(r),children:[e.jsx(ut,{id:"edit-type",children:e.jsx(mt,{placeholder:"Select a type..."})}),e.jsxs(xt,{children:[e.jsx(De,{value:"",children:"-- None --"}),Nt.map(r=>e.jsx(De,{value:r,children:r},r))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Categorize this product for filtering and organization."})]})]}),e.jsxs(me,{children:[e.jsx(b,{variant:"outline",onClick:()=>_(null),disabled:R,children:"Cancel"}),e.jsx(b,{onClick:Us,disabled:R,children:R?"Saving...":"Save Changes"})]})]})}),e.jsx(oe,{open:p,onOpenChange:k,children:e.jsxs(ce,{className:"max-w-lg",children:[e.jsx(de,{children:e.jsx(ue,{children:"Import Results"})}),zs?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Importing products..."})]}):C?e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-green-500/10",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:C.updated}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Updated"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-amber-500/10",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:C.skipped}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Skipped"})]})]}),C.warnings.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs($,{children:["Warnings (",C.warnings.length,")"]}),e.jsx("div",{className:"max-h-[200px] overflow-auto rounded-md border p-3 bg-muted/50",children:C.warnings.map((r,N)=>e.jsx("p",{className:"text-xs text-amber-600 mb-1",children:r},N))})]})]}):null,e.jsx(me,{children:e.jsx(b,{onClick:()=>k(!1),children:"Close"})})]})})]})}function Oa(){const[s,t]=n.useState([]),[a,l]=n.useState(!0),[i,d]=n.useState(!1),[o,u]=n.useState(null),[c,g]=n.useState(null),{toast:f}=W(),h=async()=>{l(!0),u(null);try{const[v,w,x]=await Promise.all([kt(),Ve(),Ue()]);if(v.value&&v.value.length>0)t(v.value);else{const A=x.map(T=>T.name),R=w.filter(T=>!T.group_id).map(T=>T.label||T.product_name);t([...A,...R])}}catch(v){u(v instanceof Error?v.message:"Failed to load sort order")}finally{l(!1)}};n.useEffect(()=>{h()},[]);const m=v=>{g(v)},y=(v,w)=>{if(v.preventDefault(),c===null||c===w)return;const x=[...s],[A]=x.splice(c,1);x.splice(w,0,A),t(x),g(w)},j=()=>{g(null)},_=async()=>{d(!0);try{await _t(s),f({title:"Success",description:"Sort order saved"})}catch(v){f({variant:"destructive",title:"Error",description:v instanceof Error?v.message:"Failed to save sort order"})}finally{d(!1)}};return a?e.jsx(re,{message:"Loading sort order..."}):o?e.jsx(te,{message:o,onRetry:h}):e.jsxs(z,{children:[e.jsxs(O,{children:[e.jsx(V,{children:"Sort Order"}),e.jsx(Z,{children:"Drag items to reorder how they appear in reports"})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border divide-y",children:s.map((v,w)=>e.jsxs("div",{draggable:!0,onDragStart:()=>m(w),onDragOver:x=>y(x,w),onDragEnd:j,className:`flex items-center gap-3 p-3 cursor-move transition-colors ${c===w?"bg-accent":"hover:bg-accent/50"}`,children:[e.jsx(Gt,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm text-muted-foreground w-6",children:w+1}),e.jsx("span",{className:"flex-1 font-medium",children:v})]},`${v}-${w}`))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:_,disabled:i,children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),i?"Saving...":"Save Order"]}),e.jsxs(b,{variant:"outline",onClick:h,children:[e.jsx(St,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]})]})}function Va({open:s,onOpenChange:t,title:a,description:l,children:i,footer:d}){return e.jsx(oe,{open:s,onOpenChange:t,children:e.jsxs(ce,{className:"sm:max-w-[500px]",children:[e.jsxs(de,{children:[e.jsx(ue,{children:a}),l&&e.jsx(ze,{children:l})]}),e.jsx("div",{className:"py-4",children:i}),d&&e.jsx(me,{children:d})]})})}function Ua(){const[s,t]=n.useState(null),[a,l]=n.useState(""),[i,d]=n.useState(""),[o,u]=n.useState(!1),{toast:c}=W(),g=[{id:"clear_transactions",title:"Clear All Transactions",description:"Delete ALL transaction records from the database. This cannot be undone.",confirmText:"DELETE",action:async()=>{await K("transactions")}},{id:"clear_transactions_by_date",title:"Clear Transactions by Date",description:"Delete all transactions from a specific date onwards. Useful for re-importing data.",confirmText:"DELETE",requiresDate:!0,action:async()=>{if(!i)throw new Error("Date is required");await Dt(i)}},{id:"clear_products",title:"Clear All Products",description:"Delete all discovered products from the database. You will need to re-import CSVs to discover them again.",confirmText:"DELETE",action:async()=>{await K("products"),await K("all_products")}},{id:"clear_groups",title:"Clear All Groups",description:"Delete all product groups. Products will be ungrouped but remain in the system.",confirmText:"DELETE",action:async()=>{await K("product_groups")}},{id:"reset_all",title:"Reset Entire Database",description:"Delete ALL data: transactions, products, groups, balance data, and import history. Complete factory reset.",confirmText:"RESET",action:async()=>{await At()}}],f=async()=>{if(s){if(a!==s.confirmText){c({variant:"destructive",title:"Confirmation failed",description:`Please type "${s.confirmText}" to confirm`});return}if(s.requiresDate&&!i){c({variant:"destructive",title:"Date required",description:"Please select a date"});return}u(!0);try{await s.action(),c({title:"Success",description:`${s.title} completed`}),h()}catch(m){c({variant:"destructive",title:"Error",description:m instanceof Error?m.message:"Action failed"})}finally{u(!1)}}},h=()=>{t(null),l(""),d("")};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{className:"border-destructive/30",children:[e.jsxs(O,{children:[e.jsxs(V,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(he,{className:"h-5 w-5"}),"Danger Zone"]}),e.jsx(Z,{children:"Irreversible actions that affect your data. Use with extreme caution."})]}),e.jsx(U,{className:"space-y-4",children:g.map(m=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-destructive/20 bg-destructive/5 p-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.description})]}),e.jsxs(b,{variant:"destructive",size:"sm",onClick:()=>t(m),children:[m.id==="reset_all"?e.jsx(Zt,{className:"mr-2 h-4 w-4"}):m.requiresDate?e.jsx(Tt,{className:"mr-2 h-4 w-4"}):e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Execute"]})]},m.id))})]}),e.jsx(Va,{open:!!s,onOpenChange:m=>!m&&h(),title:`Confirm: ${s?.title}`,description:"This action cannot be undone. Please read carefully.",footer:e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"outline",onClick:h,disabled:o,children:"Cancel"}),e.jsx(b,{variant:"destructive",onClick:f,disabled:o||a!==s?.confirmText||s?.requiresDate&&!i,children:o?"Executing...":"Confirm"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg bg-destructive/10 p-4",children:e.jsxs("p",{className:"text-sm text-destructive",children:[e.jsx("strong",{children:"Warning:"})," ",s?.description]})}),s?.requiresDate&&e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"date-input",children:"Delete transactions from this date onwards"}),e.jsx(M,{id:"date-input",type:"date",value:i,onChange:m=>d(m.target.value),className:"font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs($,{htmlFor:"confirm",children:["Type ",e.jsx("strong",{children:s?.confirmText})," to confirm"]}),e.jsx(M,{id:"confirm",value:a,onChange:m=>l(m.target.value),placeholder:s?.confirmText,className:"font-mono"})]})]})})]})}function Ya(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage groups, upload data, and configure settings"})]}),e.jsxs(la,{defaultValue:"groups",className:"w-full",children:[e.jsx("div",{className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:e.jsxs(rs,{className:"inline-flex w-auto min-w-full sm:grid sm:w-full sm:max-w-[900px] sm:grid-cols-6",children:[e.jsxs(q,{value:"groups",className:"flex items-center gap-2 px-3 sm:px-4",children:[e.jsx(xe,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Groups"})]}),e.jsxs(q,{value:"products",className:"flex items-center gap-2 px-3 sm:px-4",children:[e.jsx(Yt,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Products"})]}),e.jsxs(q,{value:"upload",className:"flex items-center gap-2 px-3 sm:px-4",children:[e.jsx(ge,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Upload"})]}),e.jsxs(q,{value:"balance",className:"flex items-center gap-2 px-3 sm:px-4",children:[e.jsx(Ks,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Balance"})]}),e.jsxs(q,{value:"sort",className:"flex items-center gap-2 px-3 sm:px-4",children:[e.jsx(Bt,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Sort"})]}),e.jsxs(q,{value:"danger",className:"flex items-center gap-2 px-3 sm:px-4 text-destructive data-[state=active]:text-destructive",children:[e.jsx(he,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:"Danger"})]})]})}),e.jsx(B,{value:"groups",className:"mt-6",children:e.jsx(Sa,{})}),e.jsx(B,{value:"products",className:"mt-6",children:e.jsx(za,{})}),e.jsx(B,{value:"upload",className:"mt-6",children:e.jsx(La,{})}),e.jsx(B,{value:"balance",className:"mt-6",children:e.jsx(Ma,{})}),e.jsx(B,{value:"sort",className:"mt-6",children:e.jsx(Oa,{})}),e.jsx(B,{value:"danger",className:"mt-6",children:e.jsx(Ua,{})})]})]})}export{Ya as default};
